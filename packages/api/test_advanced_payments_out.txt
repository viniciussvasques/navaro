Using selector: EpollSelector
Using selector: EpollSelector
[2m2026-02-05T14:49:05.147750Z[0m [[32m[1minfo     [0m] [1mStarting application          [0m [[0m[1m[34mapp.main[0m][0m [36mapp[0m=[35m'Navaro API'[0m [36menvironment[0m=[35mdevelopment[0m [36mmode[0m=[35mdebug[0m [36mname[0m=[35m'Navaro API'[0m [36mversion[0m=[35m1.0.0[0m
2026-02-05 15:49:05,206 INFO sqlalchemy.engine.Engine select pg_catalog.version()
select pg_catalog.version()
2026-02-05 15:49:05,206 INFO sqlalchemy.engine.Engine [raw sql] ()
[raw sql] ()
2026-02-05 15:49:05,212 INFO sqlalchemy.engine.Engine select current_schema()
select current_schema()
2026-02-05 15:49:05,212 INFO sqlalchemy.engine.Engine [raw sql] ()
[raw sql] ()
2026-02-05 15:49:05,219 INFO sqlalchemy.engine.Engine show standard_conforming_strings
show standard_conforming_strings
2026-02-05 15:49:05,219 INFO sqlalchemy.engine.Engine [raw sql] ()
[raw sql] ()
2026-02-05 15:49:05,223 INFO sqlalchemy.engine.Engine BEGIN (implicit)
BEGIN (implicit)
2026-02-05 15:49:05,229 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-05 15:49:05,229 INFO sqlalchemy.engine.Engine [generated in 0.00057s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[generated in 0.00057s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-05 15:49:05,246 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-05 15:49:05,246 INFO sqlalchemy.engine.Engine [cached since 0.01764s ago] ('establishments', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[cached since 0.01764s ago] ('establishments', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-05 15:49:05,248 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-05 15:49:05,249 INFO sqlalchemy.engine.Engine [cached since 0.02005s ago] ('service_staff', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[cached since 0.02005s ago] ('service_staff', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-05 15:49:05,251 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-05 15:49:05,251 INFO sqlalchemy.engine.Engine [cached since 0.02284s ago] ('services', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[cached since 0.02284s ago] ('services', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-05 15:49:05,254 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-05 15:49:05,254 INFO sqlalchemy.engine.Engine [cached since 0.02569s ago] ('service_bundles', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[cached since 0.02569s ago] ('service_bundles', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-05 15:49:05,256 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-05 15:49:05,256 INFO sqlalchemy.engine.Engine [cached since 0.02762s ago] ('service_bundle_items', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[cached since 0.02762s ago] ('service_bundle_items', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-05 15:49:05,259 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-05 15:49:05,259 INFO sqlalchemy.engine.Engine [cached since 0.03033s ago] ('staff_members', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[cached since 0.03033s ago] ('staff_members', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-05 15:49:05,260 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-05 15:49:05,260 INFO sqlalchemy.engine.Engine [cached since 0.03159s ago] ('staff_blocks', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[cached since 0.03159s ago] ('staff_blocks', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-05 15:49:05,261 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-05 15:49:05,262 INFO sqlalchemy.engine.Engine [cached since 0.03298s ago] ('subscription_plans', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[cached since 0.03298s ago] ('subscription_plans', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-05 15:49:05,263 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-05 15:49:05,263 INFO sqlalchemy.engine.Engine [cached since 0.03437s ago] ('subscription_plan_items', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[cached since 0.03437s ago] ('subscription_plan_items', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-05 15:49:05,264 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-05 15:49:05,264 INFO sqlalchemy.engine.Engine [cached since 0.03564s ago] ('subscriptions', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[cached since 0.03564s ago] ('subscriptions', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-05 15:49:05,265 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-05 15:49:05,265 INFO sqlalchemy.engine.Engine [cached since 0.03669s ago] ('subscription_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[cached since 0.03669s ago] ('subscription_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-05 15:49:05,267 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-05 15:49:05,268 INFO sqlalchemy.engine.Engine [cached since 0.03931s ago] ('appointments', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[cached since 0.03931s ago] ('appointments', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-05 15:49:05,269 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-05 15:49:05,269 INFO sqlalchemy.engine.Engine [cached since 0.04062s ago] ('appointment_products', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[cached since 0.04062s ago] ('appointment_products', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-05 15:49:05,271 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-05 15:49:05,272 INFO sqlalchemy.engine.Engine [cached since 0.04298s ago] ('checkins', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[cached since 0.04298s ago] ('checkins', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-05 15:49:05,274 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-05 15:49:05,274 INFO sqlalchemy.engine.Engine [cached since 0.04547s ago] ('queue_entries', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[cached since 0.04547s ago] ('queue_entries', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-05 15:49:05,277 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-05 15:49:05,278 INFO sqlalchemy.engine.Engine [cached since 0.04945s ago] ('reviews', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[cached since 0.04945s ago] ('reviews', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-05 15:49:05,281 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-05 15:49:05,281 INFO sqlalchemy.engine.Engine [cached since 0.05284s ago] ('favorites', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[cached since 0.05284s ago] ('favorites', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-05 15:49:05,283 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-05 15:49:05,283 INFO sqlalchemy.engine.Engine [cached since 0.05469s ago] ('favorite_staff', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[cached since 0.05469s ago] ('favorite_staff', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-05 15:49:05,286 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-05 15:49:05,286 INFO sqlalchemy.engine.Engine [cached since 0.05781s ago] ('payments', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[cached since 0.05781s ago] ('payments', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-05 15:49:05,289 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-05 15:49:05,289 INFO sqlalchemy.engine.Engine [cached since 0.06078s ago] ('tips', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[cached since 0.06078s ago] ('tips', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-05 15:49:05,292 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-05 15:49:05,293 INFO sqlalchemy.engine.Engine [cached since 0.06411s ago] ('payouts', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[cached since 0.06411s ago] ('payouts', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-05 15:49:05,296 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-05 15:49:05,296 INFO sqlalchemy.engine.Engine [cached since 0.06744s ago] ('portfolio_images', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[cached since 0.06744s ago] ('portfolio_images', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-05 15:49:05,298 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-05 15:49:05,298 INFO sqlalchemy.engine.Engine [cached since 0.06953s ago] ('search_history', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[cached since 0.06953s ago] ('search_history', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-05 15:49:05,300 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-05 15:49:05,300 INFO sqlalchemy.engine.Engine [cached since 0.07177s ago] ('products', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[cached since 0.07177s ago] ('products', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-05 15:49:05,302 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-05 15:49:05,302 INFO sqlalchemy.engine.Engine [cached since 0.07388s ago] ('establishment_plugins', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[cached since 0.07388s ago] ('establishment_plugins', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-05 15:49:05,304 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-05 15:49:05,304 INFO sqlalchemy.engine.Engine [cached since 0.07553s ago] ('ad_campaigns', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[cached since 0.07553s ago] ('ad_campaigns', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-05 15:49:05,305 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-05 15:49:05,305 INFO sqlalchemy.engine.Engine [cached since 0.07665s ago] ('notifications', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[cached since 0.07665s ago] ('notifications', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-05 15:49:05,309 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-05 15:49:05,310 INFO sqlalchemy.engine.Engine [cached since 0.08116s ago] ('user_debts', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[cached since 0.08116s ago] ('user_debts', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-05 15:49:05,312 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-05 15:49:05,312 INFO sqlalchemy.engine.Engine [cached since 0.08353s ago] ('user_wallets', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[cached since 0.08353s ago] ('user_wallets', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-05 15:49:05,314 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
2026-02-05 15:49:05,315 INFO sqlalchemy.engine.Engine [cached since 0.08599s ago] ('wallet_transactions', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
[cached since 0.08599s ago] ('wallet_transactions', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
2026-02-05 15:49:05,320 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-02-05 15:49:05,321 INFO sqlalchemy.engine.Engine [generated in 0.00096s] ('userrole', 'pg_catalog')
[generated in 0.00096s] ('userrole', 'pg_catalog')
2026-02-05 15:49:05,328 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-02-05 15:49:05,328 INFO sqlalchemy.engine.Engine [cached since 0.008385s ago] ('establishmentcategory', 'pg_catalog')
[cached since 0.008385s ago] ('establishmentcategory', 'pg_catalog')
2026-02-05 15:49:05,332 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-02-05 15:49:05,332 INFO sqlalchemy.engine.Engine [cached since 0.01218s ago] ('establishmentstatus', 'pg_catalog')
[cached since 0.01218s ago] ('establishmentstatus', 'pg_catalog')
2026-02-05 15:49:05,335 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-02-05 15:49:05,335 INFO sqlalchemy.engine.Engine [cached since 0.01561s ago] ('subscriptiontier', 'pg_catalog')
[cached since 0.01561s ago] ('subscriptiontier', 'pg_catalog')
2026-02-05 15:49:05,339 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-02-05 15:49:05,339 INFO sqlalchemy.engine.Engine [cached since 0.0193s ago] ('subscriptionstatus', 'pg_catalog')
[cached since 0.0193s ago] ('subscriptionstatus', 'pg_catalog')
2026-02-05 15:49:05,343 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-02-05 15:49:05,343 INFO sqlalchemy.engine.Engine [cached since 0.02344s ago] ('appointmentstatus', 'pg_catalog')
[cached since 0.02344s ago] ('appointmentstatus', 'pg_catalog')
2026-02-05 15:49:05,346 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-02-05 15:49:05,346 INFO sqlalchemy.engine.Engine [cached since 0.02616s ago] ('paymenttype', 'pg_catalog')
[cached since 0.02616s ago] ('paymenttype', 'pg_catalog')
2026-02-05 15:49:05,348 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-02-05 15:49:05,348 INFO sqlalchemy.engine.Engine [cached since 0.02794s ago] ('queuestatus', 'pg_catalog')
[cached since 0.02794s ago] ('queuestatus', 'pg_catalog')
2026-02-05 15:49:05,349 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-02-05 15:49:05,349 INFO sqlalchemy.engine.Engine [cached since 0.02938s ago] ('paymentpurpose', 'pg_catalog')
[cached since 0.02938s ago] ('paymentpurpose', 'pg_catalog')
2026-02-05 15:49:05,351 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-02-05 15:49:05,351 INFO sqlalchemy.engine.Engine [cached since 0.03131s ago] ('paymentstatus', 'pg_catalog')
[cached since 0.03131s ago] ('paymentstatus', 'pg_catalog')
2026-02-05 15:49:05,353 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-02-05 15:49:05,353 INFO sqlalchemy.engine.Engine [cached since 0.03307s ago] ('notificationtype', 'pg_catalog')
[cached since 0.03307s ago] ('notificationtype', 'pg_catalog')
2026-02-05 15:49:05,355 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-02-05 15:49:05,355 INFO sqlalchemy.engine.Engine [cached since 0.0353s ago] ('debtstatus', 'pg_catalog')
[cached since 0.0353s ago] ('debtstatus', 'pg_catalog')
2026-02-05 15:49:05,356 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-02-05 15:49:05,357 INFO sqlalchemy.engine.Engine [cached since 0.03675s ago] ('transactiontype', 'pg_catalog')
[cached since 0.03675s ago] ('transactiontype', 'pg_catalog')
2026-02-05 15:49:05,358 INFO sqlalchemy.engine.Engine SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
2026-02-05 15:49:05,359 INFO sqlalchemy.engine.Engine [cached since 0.03876s ago] ('transactionstatus', 'pg_catalog')
[cached since 0.03876s ago] ('transactionstatus', 'pg_catalog')
2026-02-05 15:49:05,360 INFO sqlalchemy.engine.Engine COMMIT
COMMIT
[2m2026-02-05T14:49:05.362090Z[0m [[32m[1minfo     [0m] [1mDatabase initialized          [0m [[0m[1m[34mapp.main[0m][0m [36mapp[0m=[35m'Navaro API'[0m [36menvironment[0m=[35mdevelopment[0m [36mmode[0m=[35mdebug[0m [36mversion[0m=[35m1.0.0[0m
[2m2026-02-05T14:49:05.369337Z[0m [[32m[1minfo     [0m] [1mVerification code sent        [0m [[0m[1m[34mapp.api.v1.auth[0m][0m [36mapp[0m=[35m'Navaro API'[0m [36menvironment[0m=[35mdevelopment[0m [36mmethod[0m=[35mPOST[0m [36mmode[0m=[35mdebug[0m [36mpath[0m=[35m/api/v1/auth/send-code[0m [36mphone[0m=[35m+5511988887777[0m [36mrequest_id[0m=[35me5358a0f-b13a-4dac-acf9-93293613b92c[0m [36mversion[0m=[35m1.0.0[0m
[2m2026-02-05T14:49:05.370238Z[0m [[32m[1minfo     [0m] [1mRequest completed             [0m [[0m[1m[34mapp.core.middleware[0m][0m [36mapp[0m=[35m'Navaro API'[0m [36mduration_ms[0m=[35m5.01[0m [36menvironment[0m=[35mdevelopment[0m [36mmethod[0m=[35mPOST[0m [36mmode[0m=[35mdebug[0m [36mpath[0m=[35m/api/v1/auth/send-code[0m [36mrequest_id[0m=[35me5358a0f-b13a-4dac-acf9-93293613b92c[0m [36mstatus_code[0m=[35m200[0m [36mversion[0m=[35m1.0.0[0m
2026-02-05 15:49:05,380 INFO sqlalchemy.engine.Engine BEGIN (implicit)
BEGIN (implicit)
2026-02-05 15:49:05,517 INFO sqlalchemy.engine.Engine SELECT users.phone, users.name, users.email, users.avatar_url, users.role, users.referral_code, users.referred_by_id, users.id, users.created_at, users.updated_at 
FROM users 
WHERE users.phone = $1::VARCHAR
SELECT users.phone, users.name, users.email, users.avatar_url, users.role, users.referral_code, users.referred_by_id, users.id, users.created_at, users.updated_at 
FROM users 
WHERE users.phone = $1::VARCHAR
2026-02-05 15:49:05,517 INFO sqlalchemy.engine.Engine [generated in 0.00049s] ('+5511988887777',)
[generated in 0.00049s] ('+5511988887777',)
[2m2026-02-05T14:49:05.568355Z[0m [[32m[1minfo     [0m] [1mUser authenticated            [0m [[0m[1m[34mapp.api.v1.auth[0m][0m [36mapp[0m=[35m'Navaro API'[0m [36menvironment[0m=[35mdevelopment[0m [36mmethod[0m=[35mPOST[0m [36mmode[0m=[35mdebug[0m [36mpath[0m=[35m/api/v1/auth/verify[0m [36mrequest_id[0m=[35m8936ccb2-fe60-4cbf-aee7-fe7305ff4e6b[0m [36muser_id[0m=[35m1bec427c-d8f4-47f8-963a-f2dcba2a6133[0m [36mversion[0m=[35m1.0.0[0m
2026-02-05 15:49:05,569 INFO sqlalchemy.engine.Engine ROLLBACK
ROLLBACK
[2m2026-02-05T14:49:05.570379Z[0m [[32m[1minfo     [0m] [1mRequest completed             [0m [[0m[1m[34mapp.core.middleware[0m][0m [36mapp[0m=[35m'Navaro API'[0m [36mduration_ms[0m=[35m198.1[0m [36menvironment[0m=[35mdevelopment[0m [36mmethod[0m=[35mPOST[0m [36mmode[0m=[35mdebug[0m [36mpath[0m=[35m/api/v1/auth/verify[0m [36mrequest_id[0m=[35m8936ccb2-fe60-4cbf-aee7-fe7305ff4e6b[0m [36mstatus_code[0m=[35m200[0m [36mversion[0m=[35m1.0.0[0m
2026-02-05 15:49:05,577 INFO sqlalchemy.engine.Engine BEGIN (implicit)
BEGIN (implicit)
2026-02-05 15:49:05,579 INFO sqlalchemy.engine.Engine SELECT users.phone, users.name, users.email, users.avatar_url, users.role, users.referral_code, users.referred_by_id, users.id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
SELECT users.phone, users.name, users.email, users.avatar_url, users.role, users.referral_code, users.referred_by_id, users.id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-05 15:49:05,579 INFO sqlalchemy.engine.Engine [generated in 0.00034s] (UUID('1bec427c-d8f4-47f8-963a-f2dcba2a6133'),)
[generated in 0.00034s] (UUID('1bec427c-d8f4-47f8-963a-f2dcba2a6133'),)
2026-02-05 15:49:05,586 INFO sqlalchemy.engine.Engine SELECT establishments.owner_id, establishments.name, establishments.slug, establishments.category, establishments.description, establishments.address, establishments.city, establishments.state, establishments.zip_code, establishments.latitude, establishments.longitude, establishments.phone, establishments.whatsapp, establishments.logo_url, establishments.cover_url, establishments.google_place_id, establishments.google_maps_url, establishments.business_hours, establishments.queue_mode_enabled, establishments.status, establishments.subscription_tier, establishments.stripe_account_id, establishments.cancellation_fee_fixed, establishments.no_show_fee_percent, establishments.deposit_percent, establishments.id, establishments.created_at, establishments.updated_at 
FROM establishments 
WHERE establishments.slug = $1::VARCHAR
SELECT establishments.owner_id, establishments.name, establishments.slug, establishments.category, establishments.description, establishments.address, establishments.city, establishments.state, establishments.zip_code, establishments.latitude, establishments.longitude, establishments.phone, establishments.whatsapp, establishments.logo_url, establishments.cover_url, establishments.google_place_id, establishments.google_maps_url, establishments.business_hours, establishments.queue_mode_enabled, establishments.status, establishments.subscription_tier, establishments.stripe_account_id, establishments.cancellation_fee_fixed, establishments.no_show_fee_percent, establishments.deposit_percent, establishments.id, establishments.created_at, establishments.updated_at 
FROM establishments 
WHERE establishments.slug = $1::VARCHAR
2026-02-05 15:49:05,587 INFO sqlalchemy.engine.Engine [generated in 0.00048s] ('advanced-barbershop',)
[generated in 0.00048s] ('advanced-barbershop',)
2026-02-05 15:49:05,607 INFO sqlalchemy.engine.Engine SELECT establishments.owner_id, establishments.name, establishments.slug, establishments.category, establishments.description, establishments.address, establishments.city, establishments.state, establishments.zip_code, establishments.latitude, establishments.longitude, establishments.phone, establishments.whatsapp, establishments.logo_url, establishments.cover_url, establishments.google_place_id, establishments.google_maps_url, establishments.business_hours, establishments.queue_mode_enabled, establishments.status, establishments.subscription_tier, establishments.stripe_account_id, establishments.cancellation_fee_fixed, establishments.no_show_fee_percent, establishments.deposit_percent, establishments.id, establishments.created_at, establishments.updated_at 
FROM establishments 
WHERE establishments.slug = $1::VARCHAR
SELECT establishments.owner_id, establishments.name, establishments.slug, establishments.category, establishments.description, establishments.address, establishments.city, establishments.state, establishments.zip_code, establishments.latitude, establishments.longitude, establishments.phone, establishments.whatsapp, establishments.logo_url, establishments.cover_url, establishments.google_place_id, establishments.google_maps_url, establishments.business_hours, establishments.queue_mode_enabled, establishments.status, establishments.subscription_tier, establishments.stripe_account_id, establishments.cancellation_fee_fixed, establishments.no_show_fee_percent, establishments.deposit_percent, establishments.id, establishments.created_at, establishments.updated_at 
FROM establishments 
WHERE establishments.slug = $1::VARCHAR
2026-02-05 15:49:05,607 INFO sqlalchemy.engine.Engine [cached since 0.02117s ago] ('advanced-barbershop-1',)
[cached since 0.02117s ago] ('advanced-barbershop-1',)
2026-02-05 15:49:05,610 INFO sqlalchemy.engine.Engine SELECT establishments.owner_id, establishments.name, establishments.slug, establishments.category, establishments.description, establishments.address, establishments.city, establishments.state, establishments.zip_code, establishments.latitude, establishments.longitude, establishments.phone, establishments.whatsapp, establishments.logo_url, establishments.cover_url, establishments.google_place_id, establishments.google_maps_url, establishments.business_hours, establishments.queue_mode_enabled, establishments.status, establishments.subscription_tier, establishments.stripe_account_id, establishments.cancellation_fee_fixed, establishments.no_show_fee_percent, establishments.deposit_percent, establishments.id, establishments.created_at, establishments.updated_at 
FROM establishments 
WHERE establishments.slug = $1::VARCHAR
SELECT establishments.owner_id, establishments.name, establishments.slug, establishments.category, establishments.description, establishments.address, establishments.city, establishments.state, establishments.zip_code, establishments.latitude, establishments.longitude, establishments.phone, establishments.whatsapp, establishments.logo_url, establishments.cover_url, establishments.google_place_id, establishments.google_maps_url, establishments.business_hours, establishments.queue_mode_enabled, establishments.status, establishments.subscription_tier, establishments.stripe_account_id, establishments.cancellation_fee_fixed, establishments.no_show_fee_percent, establishments.deposit_percent, establishments.id, establishments.created_at, establishments.updated_at 
FROM establishments 
WHERE establishments.slug = $1::VARCHAR
2026-02-05 15:49:05,610 INFO sqlalchemy.engine.Engine [cached since 0.02426s ago] ('advanced-barbershop-2',)
[cached since 0.02426s ago] ('advanced-barbershop-2',)
2026-02-05 15:49:05,613 INFO sqlalchemy.engine.Engine SELECT establishments.owner_id, establishments.name, establishments.slug, establishments.category, establishments.description, establishments.address, establishments.city, establishments.state, establishments.zip_code, establishments.latitude, establishments.longitude, establishments.phone, establishments.whatsapp, establishments.logo_url, establishments.cover_url, establishments.google_place_id, establishments.google_maps_url, establishments.business_hours, establishments.queue_mode_enabled, establishments.status, establishments.subscription_tier, establishments.stripe_account_id, establishments.cancellation_fee_fixed, establishments.no_show_fee_percent, establishments.deposit_percent, establishments.id, establishments.created_at, establishments.updated_at 
FROM establishments 
WHERE establishments.slug = $1::VARCHAR
SELECT establishments.owner_id, establishments.name, establishments.slug, establishments.category, establishments.description, establishments.address, establishments.city, establishments.state, establishments.zip_code, establishments.latitude, establishments.longitude, establishments.phone, establishments.whatsapp, establishments.logo_url, establishments.cover_url, establishments.google_place_id, establishments.google_maps_url, establishments.business_hours, establishments.queue_mode_enabled, establishments.status, establishments.subscription_tier, establishments.stripe_account_id, establishments.cancellation_fee_fixed, establishments.no_show_fee_percent, establishments.deposit_percent, establishments.id, establishments.created_at, establishments.updated_at 
FROM establishments 
WHERE establishments.slug = $1::VARCHAR
2026-02-05 15:49:05,613 INFO sqlalchemy.engine.Engine [cached since 0.02726s ago] ('advanced-barbershop-3',)
[cached since 0.02726s ago] ('advanced-barbershop-3',)
2026-02-05 15:49:05,617 INFO sqlalchemy.engine.Engine SELECT establishments.owner_id, establishments.name, establishments.slug, establishments.category, establishments.description, establishments.address, establishments.city, establishments.state, establishments.zip_code, establishments.latitude, establishments.longitude, establishments.phone, establishments.whatsapp, establishments.logo_url, establishments.cover_url, establishments.google_place_id, establishments.google_maps_url, establishments.business_hours, establishments.queue_mode_enabled, establishments.status, establishments.subscription_tier, establishments.stripe_account_id, establishments.cancellation_fee_fixed, establishments.no_show_fee_percent, establishments.deposit_percent, establishments.id, establishments.created_at, establishments.updated_at 
FROM establishments 
WHERE establishments.slug = $1::VARCHAR
SELECT establishments.owner_id, establishments.name, establishments.slug, establishments.category, establishments.description, establishments.address, establishments.city, establishments.state, establishments.zip_code, establishments.latitude, establishments.longitude, establishments.phone, establishments.whatsapp, establishments.logo_url, establishments.cover_url, establishments.google_place_id, establishments.google_maps_url, establishments.business_hours, establishments.queue_mode_enabled, establishments.status, establishments.subscription_tier, establishments.stripe_account_id, establishments.cancellation_fee_fixed, establishments.no_show_fee_percent, establishments.deposit_percent, establishments.id, establishments.created_at, establishments.updated_at 
FROM establishments 
WHERE establishments.slug = $1::VARCHAR
2026-02-05 15:49:05,617 INFO sqlalchemy.engine.Engine [cached since 0.03122s ago] ('advanced-barbershop-4',)
[cached since 0.03122s ago] ('advanced-barbershop-4',)
2026-02-05 15:49:05,621 INFO sqlalchemy.engine.Engine SELECT establishments.owner_id, establishments.name, establishments.slug, establishments.category, establishments.description, establishments.address, establishments.city, establishments.state, establishments.zip_code, establishments.latitude, establishments.longitude, establishments.phone, establishments.whatsapp, establishments.logo_url, establishments.cover_url, establishments.google_place_id, establishments.google_maps_url, establishments.business_hours, establishments.queue_mode_enabled, establishments.status, establishments.subscription_tier, establishments.stripe_account_id, establishments.cancellation_fee_fixed, establishments.no_show_fee_percent, establishments.deposit_percent, establishments.id, establishments.created_at, establishments.updated_at 
FROM establishments 
WHERE establishments.slug = $1::VARCHAR
SELECT establishments.owner_id, establishments.name, establishments.slug, establishments.category, establishments.description, establishments.address, establishments.city, establishments.state, establishments.zip_code, establishments.latitude, establishments.longitude, establishments.phone, establishments.whatsapp, establishments.logo_url, establishments.cover_url, establishments.google_place_id, establishments.google_maps_url, establishments.business_hours, establishments.queue_mode_enabled, establishments.status, establishments.subscription_tier, establishments.stripe_account_id, establishments.cancellation_fee_fixed, establishments.no_show_fee_percent, establishments.deposit_percent, establishments.id, establishments.created_at, establishments.updated_at 
FROM establishments 
WHERE establishments.slug = $1::VARCHAR
2026-02-05 15:49:05,621 INFO sqlalchemy.engine.Engine [cached since 0.03502s ago] ('advanced-barbershop-5',)
[cached since 0.03502s ago] ('advanced-barbershop-5',)
2026-02-05 15:49:05,625 INFO sqlalchemy.engine.Engine SELECT establishments.owner_id, establishments.name, establishments.slug, establishments.category, establishments.description, establishments.address, establishments.city, establishments.state, establishments.zip_code, establishments.latitude, establishments.longitude, establishments.phone, establishments.whatsapp, establishments.logo_url, establishments.cover_url, establishments.google_place_id, establishments.google_maps_url, establishments.business_hours, establishments.queue_mode_enabled, establishments.status, establishments.subscription_tier, establishments.stripe_account_id, establishments.cancellation_fee_fixed, establishments.no_show_fee_percent, establishments.deposit_percent, establishments.id, establishments.created_at, establishments.updated_at 
FROM establishments 
WHERE establishments.slug = $1::VARCHAR
SELECT establishments.owner_id, establishments.name, establishments.slug, establishments.category, establishments.description, establishments.address, establishments.city, establishments.state, establishments.zip_code, establishments.latitude, establishments.longitude, establishments.phone, establishments.whatsapp, establishments.logo_url, establishments.cover_url, establishments.google_place_id, establishments.google_maps_url, establishments.business_hours, establishments.queue_mode_enabled, establishments.status, establishments.subscription_tier, establishments.stripe_account_id, establishments.cancellation_fee_fixed, establishments.no_show_fee_percent, establishments.deposit_percent, establishments.id, establishments.created_at, establishments.updated_at 
FROM establishments 
WHERE establishments.slug = $1::VARCHAR
2026-02-05 15:49:05,625 INFO sqlalchemy.engine.Engine [cached since 0.03911s ago] ('advanced-barbershop-6',)
[cached since 0.03911s ago] ('advanced-barbershop-6',)
2026-02-05 15:49:05,632 INFO sqlalchemy.engine.Engine INSERT INTO establishments (owner_id, name, slug, category, description, address, city, state, zip_code, latitude, longitude, phone, whatsapp, logo_url, cover_url, google_place_id, google_maps_url, business_hours, queue_mode_enabled, status, subscription_tier, stripe_account_id, cancellation_fee_fixed, no_show_fee_percent, deposit_percent, id) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::establishmentcategory, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::VARCHAR, $10::NUMERIC(10, 8), $11::NUMERIC(11, 8), $12::VARCHAR, $13::VARCHAR, $14::VARCHAR, $15::VARCHAR, $16::VARCHAR, $17::VARCHAR, $18::JSON, $19::BOOLEAN, $20::establishmentstatus, $21::subscriptiontier, $22::VARCHAR, $23::NUMERIC(10, 2), $24::NUMERIC(5, 2), $25::NUMERIC(5, 2), $26::UUID) RETURNING establishments.created_at, establishments.updated_at
INSERT INTO establishments (owner_id, name, slug, category, description, address, city, state, zip_code, latitude, longitude, phone, whatsapp, logo_url, cover_url, google_place_id, google_maps_url, business_hours, queue_mode_enabled, status, subscription_tier, stripe_account_id, cancellation_fee_fixed, no_show_fee_percent, deposit_percent, id) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::establishmentcategory, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::VARCHAR, $10::NUMERIC(10, 8), $11::NUMERIC(11, 8), $12::VARCHAR, $13::VARCHAR, $14::VARCHAR, $15::VARCHAR, $16::VARCHAR, $17::VARCHAR, $18::JSON, $19::BOOLEAN, $20::establishmentstatus, $21::subscriptiontier, $22::VARCHAR, $23::NUMERIC(10, 2), $24::NUMERIC(5, 2), $25::NUMERIC(5, 2), $26::UUID) RETURNING establishments.created_at, establishments.updated_at
2026-02-05 15:49:05,632 INFO sqlalchemy.engine.Engine [generated in 0.00069s] (UUID('1bec427c-d8f4-47f8-963a-f2dcba2a6133'), 'Advanced Barbershop', 'advanced-barbershop-6', 'barbershop', None, 'Feature St', 'São Paulo', 'SP', None, None, None, '+551177777777', None, None, None, None, None, '{"mon": {"open": "00:00", "close": "23:59"}, "tue": {"open": "00:00", "close": "23:59"}, "wed": {"open": "00:00", "close": "23:59"}, "thu": {"open":  ... (10 characters truncated) ... close": "23:59"}, "fri": {"open": "00:00", "close": "23:59"}, "sat": {"open": "00:00", "close": "23:59"}, "sun": {"open": "00:00", "close": "23:59"}}', False, 'pending', 'trial', None, 0.0, 50.0, 0.0, UUID('a2fae54f-0410-43de-8a97-37a9ec49af83'))
[generated in 0.00069s] (UUID('1bec427c-d8f4-47f8-963a-f2dcba2a6133'), 'Advanced Barbershop', 'advanced-barbershop-6', 'barbershop', None, 'Feature St', 'São Paulo', 'SP', None, None, None, '+551177777777', None, None, None, None, None, '{"mon": {"open": "00:00", "close": "23:59"}, "tue": {"open": "00:00", "close": "23:59"}, "wed": {"open": "00:00", "close": "23:59"}, "thu": {"open":  ... (10 characters truncated) ... close": "23:59"}, "fri": {"open": "00:00", "close": "23:59"}, "sat": {"open": "00:00", "close": "23:59"}, "sun": {"open": "00:00", "close": "23:59"}}', False, 'pending', 'trial', None, 0.0, 50.0, 0.0, UUID('a2fae54f-0410-43de-8a97-37a9ec49af83'))
2026-02-05 15:49:05,639 INFO sqlalchemy.engine.Engine COMMIT
COMMIT
2026-02-05 15:49:05,649 INFO sqlalchemy.engine.Engine BEGIN (implicit)
BEGIN (implicit)
2026-02-05 15:49:05,653 INFO sqlalchemy.engine.Engine SELECT establishments.owner_id, establishments.name, establishments.slug, establishments.category, establishments.description, establishments.address, establishments.city, establishments.state, establishments.zip_code, establishments.latitude, establishments.longitude, establishments.phone, establishments.whatsapp, establishments.logo_url, establishments.cover_url, establishments.google_place_id, establishments.google_maps_url, establishments.business_hours, establishments.queue_mode_enabled, establishments.status, establishments.subscription_tier, establishments.stripe_account_id, establishments.cancellation_fee_fixed, establishments.no_show_fee_percent, establishments.deposit_percent, establishments.id, establishments.created_at, establishments.updated_at 
FROM establishments 
WHERE establishments.id = $1::UUID
SELECT establishments.owner_id, establishments.name, establishments.slug, establishments.category, establishments.description, establishments.address, establishments.city, establishments.state, establishments.zip_code, establishments.latitude, establishments.longitude, establishments.phone, establishments.whatsapp, establishments.logo_url, establishments.cover_url, establishments.google_place_id, establishments.google_maps_url, establishments.business_hours, establishments.queue_mode_enabled, establishments.status, establishments.subscription_tier, establishments.stripe_account_id, establishments.cancellation_fee_fixed, establishments.no_show_fee_percent, establishments.deposit_percent, establishments.id, establishments.created_at, establishments.updated_at 
FROM establishments 
WHERE establishments.id = $1::UUID
2026-02-05 15:49:05,654 INFO sqlalchemy.engine.Engine [generated in 0.00072s] (UUID('a2fae54f-0410-43de-8a97-37a9ec49af83'),)
[generated in 0.00072s] (UUID('a2fae54f-0410-43de-8a97-37a9ec49af83'),)
2026-02-05 15:49:05,665 INFO sqlalchemy.engine.Engine ROLLBACK
ROLLBACK
[2m2026-02-05T14:49:05.666156Z[0m [[32m[1minfo     [0m] [1mRequest completed             [0m [[0m[1m[34mapp.core.middleware[0m][0m [36mapp[0m=[35m'Navaro API'[0m [36mduration_ms[0m=[35m93.27[0m [36menvironment[0m=[35mdevelopment[0m [36mmethod[0m=[35mPOST[0m [36mmode[0m=[35mdebug[0m [36mpath[0m=[35m/api/v1/establishments[0m [36mrequest_id[0m=[35m6201311b-7855-4d65-af91-fe6bbd8580b5[0m [36mstatus_code[0m=[35m201[0m [36mversion[0m=[35m1.0.0[0m
2026-02-05 15:49:05,676 INFO sqlalchemy.engine.Engine BEGIN (implicit)
BEGIN (implicit)
2026-02-05 15:49:05,677 INFO sqlalchemy.engine.Engine SELECT users.phone, users.name, users.email, users.avatar_url, users.role, users.referral_code, users.referred_by_id, users.id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
SELECT users.phone, users.name, users.email, users.avatar_url, users.role, users.referral_code, users.referred_by_id, users.id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-05 15:49:05,677 INFO sqlalchemy.engine.Engine [cached since 0.09835s ago] (UUID('1bec427c-d8f4-47f8-963a-f2dcba2a6133'),)
[cached since 0.09835s ago] (UUID('1bec427c-d8f4-47f8-963a-f2dcba2a6133'),)
2026-02-05 15:49:05,686 INFO sqlalchemy.engine.Engine SELECT establishments.owner_id, establishments.name, establishments.slug, establishments.category, establishments.description, establishments.address, establishments.city, establishments.state, establishments.zip_code, establishments.latitude, establishments.longitude, establishments.phone, establishments.whatsapp, establishments.logo_url, establishments.cover_url, establishments.google_place_id, establishments.google_maps_url, establishments.business_hours, establishments.queue_mode_enabled, establishments.status, establishments.subscription_tier, establishments.stripe_account_id, establishments.cancellation_fee_fixed, establishments.no_show_fee_percent, establishments.deposit_percent, establishments.id, establishments.created_at, establishments.updated_at 
FROM establishments 
WHERE establishments.id = $1::UUID
SELECT establishments.owner_id, establishments.name, establishments.slug, establishments.category, establishments.description, establishments.address, establishments.city, establishments.state, establishments.zip_code, establishments.latitude, establishments.longitude, establishments.phone, establishments.whatsapp, establishments.logo_url, establishments.cover_url, establishments.google_place_id, establishments.google_maps_url, establishments.business_hours, establishments.queue_mode_enabled, establishments.status, establishments.subscription_tier, establishments.stripe_account_id, establishments.cancellation_fee_fixed, establishments.no_show_fee_percent, establishments.deposit_percent, establishments.id, establishments.created_at, establishments.updated_at 
FROM establishments 
WHERE establishments.id = $1::UUID
2026-02-05 15:49:05,687 INFO sqlalchemy.engine.Engine [generated in 0.00050s] (UUID('a2fae54f-0410-43de-8a97-37a9ec49af83'),)
[generated in 0.00050s] (UUID('a2fae54f-0410-43de-8a97-37a9ec49af83'),)
2026-02-05 15:49:05,693 INFO sqlalchemy.engine.Engine INSERT INTO staff_members (establishment_id, user_id, name, phone, role, avatar_url, work_schedule, commission_rate, active, id) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::JSON, $8::NUMERIC(5, 2), $9::BOOLEAN, $10::UUID) RETURNING staff_members.created_at, staff_members.updated_at
INSERT INTO staff_members (establishment_id, user_id, name, phone, role, avatar_url, work_schedule, commission_rate, active, id) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::JSON, $8::NUMERIC(5, 2), $9::BOOLEAN, $10::UUID) RETURNING staff_members.created_at, staff_members.updated_at
2026-02-05 15:49:05,693 INFO sqlalchemy.engine.Engine [generated in 0.00062s] (UUID('a2fae54f-0410-43de-8a97-37a9ec49af83'), None, 'Expert Barber', None, 'barber', None, '{"mon": {"open": "00:00", "close": "23:59"}, "tue": {"open": "00:00", "close": "23:59"}, "wed": {"open": "00:00", "close": "23:59"}, "thu": {"open":  ... (10 characters truncated) ... close": "23:59"}, "fri": {"open": "00:00", "close": "23:59"}, "sat": {"open": "00:00", "close": "23:59"}, "sun": {"open": "00:00", "close": "23:59"}}', None, True, UUID('b83ea175-3b70-4ee5-8fb6-dacf01df9fe1'))
[generated in 0.00062s] (UUID('a2fae54f-0410-43de-8a97-37a9ec49af83'), None, 'Expert Barber', None, 'barber', None, '{"mon": {"open": "00:00", "close": "23:59"}, "tue": {"open": "00:00", "close": "23:59"}, "wed": {"open": "00:00", "close": "23:59"}, "thu": {"open":  ... (10 characters truncated) ... close": "23:59"}, "fri": {"open": "00:00", "close": "23:59"}, "sat": {"open": "00:00", "close": "23:59"}, "sun": {"open": "00:00", "close": "23:59"}}', None, True, UUID('b83ea175-3b70-4ee5-8fb6-dacf01df9fe1'))
2026-02-05 15:49:05,698 INFO sqlalchemy.engine.Engine COMMIT
COMMIT
2026-02-05 15:49:05,707 INFO sqlalchemy.engine.Engine BEGIN (implicit)
BEGIN (implicit)
2026-02-05 15:49:05,868 INFO sqlalchemy.engine.Engine SELECT staff_members.establishment_id, staff_members.user_id, staff_members.name, staff_members.phone, staff_members.role, staff_members.avatar_url, staff_members.work_schedule, staff_members.commission_rate, staff_members.active, staff_members.id, staff_members.created_at, staff_members.updated_at 
FROM staff_members 
WHERE staff_members.id = $1::UUID
SELECT staff_members.establishment_id, staff_members.user_id, staff_members.name, staff_members.phone, staff_members.role, staff_members.avatar_url, staff_members.work_schedule, staff_members.commission_rate, staff_members.active, staff_members.id, staff_members.created_at, staff_members.updated_at 
FROM staff_members 
WHERE staff_members.id = $1::UUID
2026-02-05 15:49:05,869 INFO sqlalchemy.engine.Engine [generated in 0.00050s] (UUID('b83ea175-3b70-4ee5-8fb6-dacf01df9fe1'),)
[generated in 0.00050s] (UUID('b83ea175-3b70-4ee5-8fb6-dacf01df9fe1'),)
2026-02-05 15:49:05,875 INFO sqlalchemy.engine.Engine ROLLBACK
ROLLBACK
[2m2026-02-05T14:49:05.875716Z[0m [[32m[1minfo     [0m] [1mRequest completed             [0m [[0m[1m[34mapp.core.middleware[0m][0m [36mapp[0m=[35m'Navaro API'[0m [36mduration_ms[0m=[35m205.91[0m [36menvironment[0m=[35mdevelopment[0m [36mmethod[0m=[35mPOST[0m [36mmode[0m=[35mdebug[0m [36mpath[0m=[35m/api/v1/establishments/a2fae54f-0410-43de-8a97-37a9ec49af83/staff[0m [36mrequest_id[0m=[35mf658e9f2-4f97-4060-b4c1-2cfbb579db4c[0m [36mstatus_code[0m=[35m201[0m [36mversion[0m=[35m1.0.0[0m
2026-02-05 15:49:05,883 INFO sqlalchemy.engine.Engine BEGIN (implicit)
BEGIN (implicit)
2026-02-05 15:49:05,884 INFO sqlalchemy.engine.Engine SELECT users.phone, users.name, users.email, users.avatar_url, users.role, users.referral_code, users.referred_by_id, users.id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
SELECT users.phone, users.name, users.email, users.avatar_url, users.role, users.referral_code, users.referred_by_id, users.id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-05 15:49:05,884 INFO sqlalchemy.engine.Engine [cached since 0.3048s ago] (UUID('1bec427c-d8f4-47f8-963a-f2dcba2a6133'),)
[cached since 0.3048s ago] (UUID('1bec427c-d8f4-47f8-963a-f2dcba2a6133'),)
2026-02-05 15:49:05,888 INFO sqlalchemy.engine.Engine SELECT establishments.owner_id, establishments.name, establishments.slug, establishments.category, establishments.description, establishments.address, establishments.city, establishments.state, establishments.zip_code, establishments.latitude, establishments.longitude, establishments.phone, establishments.whatsapp, establishments.logo_url, establishments.cover_url, establishments.google_place_id, establishments.google_maps_url, establishments.business_hours, establishments.queue_mode_enabled, establishments.status, establishments.subscription_tier, establishments.stripe_account_id, establishments.cancellation_fee_fixed, establishments.no_show_fee_percent, establishments.deposit_percent, establishments.id, establishments.created_at, establishments.updated_at 
FROM establishments 
WHERE establishments.id = $1::UUID
SELECT establishments.owner_id, establishments.name, establishments.slug, establishments.category, establishments.description, establishments.address, establishments.city, establishments.state, establishments.zip_code, establishments.latitude, establishments.longitude, establishments.phone, establishments.whatsapp, establishments.logo_url, establishments.cover_url, establishments.google_place_id, establishments.google_maps_url, establishments.business_hours, establishments.queue_mode_enabled, establishments.status, establishments.subscription_tier, establishments.stripe_account_id, establishments.cancellation_fee_fixed, establishments.no_show_fee_percent, establishments.deposit_percent, establishments.id, establishments.created_at, establishments.updated_at 
FROM establishments 
WHERE establishments.id = $1::UUID
2026-02-05 15:49:05,888 INFO sqlalchemy.engine.Engine [cached since 0.2022s ago] (UUID('a2fae54f-0410-43de-8a97-37a9ec49af83'),)
[cached since 0.2022s ago] (UUID('a2fae54f-0410-43de-8a97-37a9ec49af83'),)
2026-02-05 15:49:05,895 INFO sqlalchemy.engine.Engine INSERT INTO services (establishment_id, name, description, price, duration_minutes, active, sort_order, deposit_required, id) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::NUMERIC(10, 2), $5::INTEGER, $6::BOOLEAN, $7::INTEGER, $8::BOOLEAN, $9::UUID) RETURNING services.created_at, services.updated_at
INSERT INTO services (establishment_id, name, description, price, duration_minutes, active, sort_order, deposit_required, id) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::NUMERIC(10, 2), $5::INTEGER, $6::BOOLEAN, $7::INTEGER, $8::BOOLEAN, $9::UUID) RETURNING services.created_at, services.updated_at
2026-02-05 15:49:05,895 INFO sqlalchemy.engine.Engine [generated in 0.00065s] (UUID('a2fae54f-0410-43de-8a97-37a9ec49af83'), 'Luxury Cut', None, 100.0, 60, True, 0, True, UUID('7f44df62-050d-4e33-b4bb-5648225e4209'))
[generated in 0.00065s] (UUID('a2fae54f-0410-43de-8a97-37a9ec49af83'), 'Luxury Cut', None, 100.0, 60, True, 0, True, UUID('7f44df62-050d-4e33-b4bb-5648225e4209'))
2026-02-05 15:49:05,900 INFO sqlalchemy.engine.Engine COMMIT
COMMIT
2026-02-05 15:49:05,906 INFO sqlalchemy.engine.Engine BEGIN (implicit)
BEGIN (implicit)
2026-02-05 15:49:05,908 INFO sqlalchemy.engine.Engine SELECT services.establishment_id, services.name, services.description, services.price, services.duration_minutes, services.active, services.sort_order, services.deposit_required, services.id, services.created_at, services.updated_at 
FROM services 
WHERE services.id = $1::UUID
SELECT services.establishment_id, services.name, services.description, services.price, services.duration_minutes, services.active, services.sort_order, services.deposit_required, services.id, services.created_at, services.updated_at 
FROM services 
WHERE services.id = $1::UUID
2026-02-05 15:49:05,908 INFO sqlalchemy.engine.Engine [generated in 0.00038s] (UUID('7f44df62-050d-4e33-b4bb-5648225e4209'),)
[generated in 0.00038s] (UUID('7f44df62-050d-4e33-b4bb-5648225e4209'),)
2026-02-05 15:49:05,918 INFO sqlalchemy.engine.Engine ROLLBACK
ROLLBACK
[2m2026-02-05T14:49:05.919192Z[0m [[32m[1minfo     [0m] [1mRequest completed             [0m [[0m[1m[34mapp.core.middleware[0m][0m [36mapp[0m=[35m'Navaro API'[0m [36mduration_ms[0m=[35m40.96[0m [36menvironment[0m=[35mdevelopment[0m [36mmethod[0m=[35mPOST[0m [36mmode[0m=[35mdebug[0m [36mpath[0m=[35m/api/v1/establishments/a2fae54f-0410-43de-8a97-37a9ec49af83/services[0m [36mrequest_id[0m=[35m3a502bc2-74cc-44dc-8e6f-d432ca6d7626[0m [36mstatus_code[0m=[35m201[0m [36mversion[0m=[35m1.0.0[0m
2026-02-05 15:49:05,985 INFO sqlalchemy.engine.Engine select pg_catalog.version()
select pg_catalog.version()
2026-02-05 15:49:05,985 INFO sqlalchemy.engine.Engine [raw sql] ()
[raw sql] ()
2026-02-05 15:49:05,993 INFO sqlalchemy.engine.Engine select current_schema()
select current_schema()
2026-02-05 15:49:05,994 INFO sqlalchemy.engine.Engine [raw sql] ()
[raw sql] ()
2026-02-05 15:49:06,000 INFO sqlalchemy.engine.Engine show standard_conforming_strings
show standard_conforming_strings
2026-02-05 15:49:06,001 INFO sqlalchemy.engine.Engine [raw sql] ()
[raw sql] ()
2026-02-05 15:49:06,011 INFO sqlalchemy.engine.Engine BEGIN (implicit)
BEGIN (implicit)
2026-02-05 15:49:06,014 INFO sqlalchemy.engine.Engine SELECT users.phone, users.name, users.email, users.avatar_url, users.role, users.referral_code, users.referred_by_id, users.id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
SELECT users.phone, users.name, users.email, users.avatar_url, users.role, users.referral_code, users.referred_by_id, users.id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
2026-02-05 15:49:06,014 INFO sqlalchemy.engine.Engine [generated in 0.00050s] (UUID('1bec427c-d8f4-47f8-963a-f2dcba2a6133'),)
[generated in 0.00050s] (UUID('1bec427c-d8f4-47f8-963a-f2dcba2a6133'),)
2026-02-05 15:49:06,080 INFO sqlalchemy.engine.Engine SELECT services.establishment_id, services.name, services.description, services.price, services.duration_minutes, services.active, services.sort_order, services.deposit_required, services.id, services.created_at, services.updated_at 
FROM services 
WHERE services.id = $1::UUID
SELECT services.establishment_id, services.name, services.description, services.price, services.duration_minutes, services.active, services.sort_order, services.deposit_required, services.id, services.created_at, services.updated_at 
FROM services 
WHERE services.id = $1::UUID
2026-02-05 15:49:06,080 INFO sqlalchemy.engine.Engine [generated in 0.00059s] (UUID('7f44df62-050d-4e33-b4bb-5648225e4209'),)
[generated in 0.00059s] (UUID('7f44df62-050d-4e33-b4bb-5648225e4209'),)
2026-02-05 15:49:06,088 INFO sqlalchemy.engine.Engine SELECT staff_members.establishment_id, staff_members.user_id, staff_members.name, staff_members.phone, staff_members.role, staff_members.avatar_url, staff_members.work_schedule, staff_members.commission_rate, staff_members.active, staff_members.id, staff_members.created_at, staff_members.updated_at 
FROM staff_members 
WHERE staff_members.id = $1::UUID
SELECT staff_members.establishment_id, staff_members.user_id, staff_members.name, staff_members.phone, staff_members.role, staff_members.avatar_url, staff_members.work_schedule, staff_members.commission_rate, staff_members.active, staff_members.id, staff_members.created_at, staff_members.updated_at 
FROM staff_members 
WHERE staff_members.id = $1::UUID
2026-02-05 15:49:06,089 INFO sqlalchemy.engine.Engine [generated in 0.00052s] (UUID('b83ea175-3b70-4ee5-8fb6-dacf01df9fe1'),)
[generated in 0.00052s] (UUID('b83ea175-3b70-4ee5-8fb6-dacf01df9fe1'),)
2026-02-05 15:49:06,101 INFO sqlalchemy.engine.Engine SELECT establishments.owner_id, establishments.name, establishments.slug, establishments.category, establishments.description, establishments.address, establishments.city, establishments.state, establishments.zip_code, establishments.latitude, establishments.longitude, establishments.phone, establishments.whatsapp, establishments.logo_url, establishments.cover_url, establishments.google_place_id, establishments.google_maps_url, establishments.business_hours, establishments.queue_mode_enabled, establishments.status, establishments.subscription_tier, establishments.stripe_account_id, establishments.cancellation_fee_fixed, establishments.no_show_fee_percent, establishments.deposit_percent, establishments.id, establishments.created_at, establishments.updated_at 
FROM establishments 
WHERE establishments.id = $1::UUID
SELECT establishments.owner_id, establishments.name, establishments.slug, establishments.category, establishments.description, establishments.address, establishments.city, establishments.state, establishments.zip_code, establishments.latitude, establishments.longitude, establishments.phone, establishments.whatsapp, establishments.logo_url, establishments.cover_url, establishments.google_place_id, establishments.google_maps_url, establishments.business_hours, establishments.queue_mode_enabled, establishments.status, establishments.subscription_tier, establishments.stripe_account_id, establishments.cancellation_fee_fixed, establishments.no_show_fee_percent, establishments.deposit_percent, establishments.id, establishments.created_at, establishments.updated_at 
FROM establishments 
WHERE establishments.id = $1::UUID
2026-02-05 15:49:06,101 INFO sqlalchemy.engine.Engine [generated in 0.00062s] (UUID('a2fae54f-0410-43de-8a97-37a9ec49af83'),)
[generated in 0.00062s] (UUID('a2fae54f-0410-43de-8a97-37a9ec49af83'),)
2026-02-05 15:49:06,129 INFO sqlalchemy.engine.Engine SELECT staff_blocks.staff_id, staff_blocks.start_at, staff_blocks.end_at, staff_blocks.reason, staff_blocks.id, staff_blocks.created_at, staff_blocks.updated_at 
FROM staff_blocks 
WHERE staff_blocks.staff_id = $1::UUID AND staff_blocks.start_at < $2::TIMESTAMP WITH TIME ZONE AND staff_blocks.end_at > $3::TIMESTAMP WITH TIME ZONE
SELECT staff_blocks.staff_id, staff_blocks.start_at, staff_blocks.end_at, staff_blocks.reason, staff_blocks.id, staff_blocks.created_at, staff_blocks.updated_at 
FROM staff_blocks 
WHERE staff_blocks.staff_id = $1::UUID AND staff_blocks.start_at < $2::TIMESTAMP WITH TIME ZONE AND staff_blocks.end_at > $3::TIMESTAMP WITH TIME ZONE
2026-02-05 15:49:06,130 INFO sqlalchemy.engine.Engine [generated in 0.00059s] (UUID('b83ea175-3b70-4ee5-8fb6-dacf01df9fe1'), datetime.datetime(2026, 2, 7, 16, 49, 5, 922404), datetime.datetime(2026, 2, 7, 15, 49, 5, 922404))
[generated in 0.00059s] (UUID('b83ea175-3b70-4ee5-8fb6-dacf01df9fe1'), datetime.datetime(2026, 2, 7, 16, 49, 5, 922404), datetime.datetime(2026, 2, 7, 15, 49, 5, 922404))
2026-02-05 15:49:06,141 INFO sqlalchemy.engine.Engine SELECT appointments.user_id, appointments.establishment_id, appointments.staff_id, appointments.service_id, appointments.bundle_id, appointments.subscription_id, appointments.scheduled_at, appointments.duration_minutes, appointments.status, appointments.payment_type, appointments.notes, appointments.cancel_reason, appointments.total_price, appointments.id, appointments.created_at, appointments.updated_at 
FROM appointments 
WHERE appointments.staff_id = $1::UUID AND appointments.status != $2::appointmentstatus AND appointments.scheduled_at < $3::TIMESTAMP WITH TIME ZONE
SELECT appointments.user_id, appointments.establishment_id, appointments.staff_id, appointments.service_id, appointments.bundle_id, appointments.subscription_id, appointments.scheduled_at, appointments.duration_minutes, appointments.status, appointments.payment_type, appointments.notes, appointments.cancel_reason, appointments.total_price, appointments.id, appointments.created_at, appointments.updated_at 
FROM appointments 
WHERE appointments.staff_id = $1::UUID AND appointments.status != $2::appointmentstatus AND appointments.scheduled_at < $3::TIMESTAMP WITH TIME ZONE
2026-02-05 15:49:06,141 INFO sqlalchemy.engine.Engine [generated in 0.00052s] (UUID('b83ea175-3b70-4ee5-8fb6-dacf01df9fe1'), 'cancelled', datetime.datetime(2026, 2, 7, 16, 49, 5, 922404))
[generated in 0.00052s] (UUID('b83ea175-3b70-4ee5-8fb6-dacf01df9fe1'), 'cancelled', datetime.datetime(2026, 2, 7, 16, 49, 5, 922404))
2026-02-05 15:49:06,172 INFO sqlalchemy.engine.Engine INSERT INTO appointments (user_id, establishment_id, staff_id, service_id, bundle_id, subscription_id, scheduled_at, duration_minutes, status, payment_type, notes, cancel_reason, total_price, id) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::TIMESTAMP WITH TIME ZONE, $8::INTEGER, $9::appointmentstatus, $10::paymenttype, $11::VARCHAR, $12::VARCHAR, $13::NUMERIC(10, 2), $14::UUID) RETURNING appointments.created_at, appointments.updated_at
INSERT INTO appointments (user_id, establishment_id, staff_id, service_id, bundle_id, subscription_id, scheduled_at, duration_minutes, status, payment_type, notes, cancel_reason, total_price, id) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::TIMESTAMP WITH TIME ZONE, $8::INTEGER, $9::appointmentstatus, $10::paymenttype, $11::VARCHAR, $12::VARCHAR, $13::NUMERIC(10, 2), $14::UUID) RETURNING appointments.created_at, appointments.updated_at
2026-02-05 15:49:06,172 INFO sqlalchemy.engine.Engine [generated in 0.00100s] (UUID('1bec427c-d8f4-47f8-963a-f2dcba2a6133'), UUID('a2fae54f-0410-43de-8a97-37a9ec49af83'), UUID('b83ea175-3b70-4ee5-8fb6-dacf01df9fe1'), UUID('7f44df62-050d-4e33-b4bb-5648225e4209'), None, None, datetime.datetime(2026, 2, 7, 15, 49, 5, 922404), 60, 'awaiting_deposit', 'single', None, None, 100.0, UUID('97576b68-ba8a-4aec-92f0-753a635d8857'))
[generated in 0.00100s] (UUID('1bec427c-d8f4-47f8-963a-f2dcba2a6133'), UUID('a2fae54f-0410-43de-8a97-37a9ec49af83'), UUID('b83ea175-3b70-4ee5-8fb6-dacf01df9fe1'), UUID('7f44df62-050d-4e33-b4bb-5648225e4209'), None, None, datetime.datetime(2026, 2, 7, 15, 49, 5, 922404), 60, 'awaiting_deposit', 'single', None, None, 100.0, UUID('97576b68-ba8a-4aec-92f0-753a635d8857'))
2026-02-05 15:49:06,179 INFO sqlalchemy.engine.Engine ROLLBACK
ROLLBACK
[2m2026-02-05T14:49:06.183210Z[0m [[31m[1merror    [0m] [1mUnhandled exception           [0m [[0m[1m[34mapp.core.middleware[0m][0m [36mapp[0m=[35m'Navaro API'[0m [36menvironment[0m=[35mdevelopment[0m [36merror[0m=[35m'(sqlalchemy.dialects.postgresql.asyncpg.Error) <class \'asyncpg.exceptions.InvalidTextRepresentationError\'>: invalid input value for enum appointmentstatus: "awaiting_deposit"\n[SQL: INSERT INTO appointments (user_id, establishment_id, staff_id, service_id, bundle_id, subscription_id, scheduled_at, duration_minutes, status, payment_type, notes, cancel_reason, total_price, id) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::TIMESTAMP WITH TIME ZONE, $8::INTEGER, $9::appointmentstatus, $10::paymenttype, $11::VARCHAR, $12::VARCHAR, $13::NUMERIC(10, 2), $14::UUID) RETURNING appointments.created_at, appointments.updated_at]\n[parameters: (UUID(\'1bec427c-d8f4-47f8-963a-f2dcba2a6133\'), UUID(\'a2fae54f-0410-43de-8a97-37a9ec49af83\'), UUID(\'b83ea175-3b70-4ee5-8fb6-dacf01df9fe1\'), UUID(\'7f44df62-050d-4e33-b4bb-5648225e4209\'), None, None, datetime.datetime(2026, 2, 7, 15, 49, 5, 922404), 60, \'awaiting_deposit\', \'single\', None, None, 100.0, UUID(\'97576b68-ba8a-4aec-92f0-753a635d8857\'))]\n(Background on this error at: https://sqlalche.me/e/20/dbapi)'[0m [36mmethod[0m=[35mPOST[0m [36mmode[0m=[35mdebug[0m [36mpath[0m=[35m/api/v1/appointments[0m [36mrequest_id[0m=[35me7851f0d-289b-4324-b2ad-8ae9dcd948a0[0m [36mversion[0m=[35m1.0.0[0m
Traceback (most recent call last):
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 550, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/asyncpg/prepared_stmt.py", line 177, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/asyncpg/prepared_stmt.py", line 268, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/asyncpg/prepared_stmt.py", line 257, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 205, in bind_execute
asyncpg.exceptions.InvalidTextRepresentationError: invalid input value for enum appointmentstatus: "awaiting_deposit"

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 952, in do_execute
    cursor.execute(statement, parameters)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 585, in execute
    self._adapt_connection.await_(
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 563, in _prepare_and_execute
    self._handle_exception(error)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 513, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 797, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.InvalidTextRepresentationError'>: invalid input value for enum appointmentstatus: "awaiting_deposit"

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/projetos/navaro/packages/api/app/core/middleware.py", line 78, in dispatch
    return await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/usr/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/app/core/middleware.py", line 175, in dispatch
    return await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/fastapi/routing.py", line 115, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/fastapi/routing.py", line 101, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/fastapi/routing.py", line 355, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/fastapi/routing.py", line 243, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/app/api/v1/appointments.py", line 68, in create_appointment
    appointment = await service.create(current_user.id, data)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/app/services/appointment_service.py", line 166, in create
    await self.db.flush()
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 787, in flush
    await greenlet_spawn(self.sync_session.flush, objects=objects)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4331, in flush
    self._flush(objects)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4466, in _flush
    with util.safe_reraise():
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4427, in _flush
    flush_context.execute()
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 527, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2363, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 952, in do_execute
    cursor.execute(statement, parameters)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 585, in execute
    self._adapt_connection.await_(
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 563, in _prepare_and_execute
    self._handle_exception(error)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 513, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 797, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.InvalidTextRepresentationError'>: invalid input value for enum appointmentstatus: "awaiting_deposit"
[SQL: INSERT INTO appointments (user_id, establishment_id, staff_id, service_id, bundle_id, subscription_id, scheduled_at, duration_minutes, status, payment_type, notes, cancel_reason, total_price, id) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::TIMESTAMP WITH TIME ZONE, $8::INTEGER, $9::appointmentstatus, $10::paymenttype, $11::VARCHAR, $12::VARCHAR, $13::NUMERIC(10, 2), $14::UUID) RETURNING appointments.created_at, appointments.updated_at]
[parameters: (UUID('1bec427c-d8f4-47f8-963a-f2dcba2a6133'), UUID('a2fae54f-0410-43de-8a97-37a9ec49af83'), UUID('b83ea175-3b70-4ee5-8fb6-dacf01df9fe1'), UUID('7f44df62-050d-4e33-b4bb-5648225e4209'), None, None, datetime.datetime(2026, 2, 7, 15, 49, 5, 922404), 60, 'awaiting_deposit', 'single', None, None, 100.0, UUID('97576b68-ba8a-4aec-92f0-753a635d8857'))]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 550, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/asyncpg/prepared_stmt.py", line 177, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/asyncpg/prepared_stmt.py", line 268, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/asyncpg/prepared_stmt.py", line 257, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 205, in bind_execute
asyncpg.exceptions.InvalidTextRepresentationError: invalid input value for enum appointmentstatus: "awaiting_deposit"

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 952, in do_execute
    cursor.execute(statement, parameters)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 585, in execute
    self._adapt_connection.await_(
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 563, in _prepare_and_execute
    self._handle_exception(error)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 513, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 797, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.InvalidTextRepresentationError'>: invalid input value for enum appointmentstatus: "awaiting_deposit"

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/projetos/navaro/packages/api/app/core/middleware.py", line 78, in dispatch
    return await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/usr/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/app/core/middleware.py", line 175, in dispatch
    return await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/fastapi/routing.py", line 115, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/fastapi/routing.py", line 101, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/fastapi/routing.py", line 355, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/fastapi/routing.py", line 243, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/app/api/v1/appointments.py", line 68, in create_appointment
    appointment = await service.create(current_user.id, data)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/app/services/appointment_service.py", line 166, in create
    await self.db.flush()
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 787, in flush
    await greenlet_spawn(self.sync_session.flush, objects=objects)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4331, in flush
    self._flush(objects)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4466, in _flush
    with util.safe_reraise():
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4427, in _flush
    flush_context.execute()
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 527, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2363, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 952, in do_execute
    cursor.execute(statement, parameters)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 585, in execute
    self._adapt_connection.await_(
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 563, in _prepare_and_execute
    self._handle_exception(error)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 513, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 797, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.InvalidTextRepresentationError'>: invalid input value for enum appointmentstatus: "awaiting_deposit"
[SQL: INSERT INTO appointments (user_id, establishment_id, staff_id, service_id, bundle_id, subscription_id, scheduled_at, duration_minutes, status, payment_type, notes, cancel_reason, total_price, id) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::TIMESTAMP WITH TIME ZONE, $8::INTEGER, $9::appointmentstatus, $10::paymenttype, $11::VARCHAR, $12::VARCHAR, $13::NUMERIC(10, 2), $14::UUID) RETURNING appointments.created_at, appointments.updated_at]
[parameters: (UUID('1bec427c-d8f4-47f8-963a-f2dcba2a6133'), UUID('a2fae54f-0410-43de-8a97-37a9ec49af83'), UUID('b83ea175-3b70-4ee5-8fb6-dacf01df9fe1'), UUID('7f44df62-050d-4e33-b4bb-5648225e4209'), None, None, datetime.datetime(2026, 2, 7, 15, 49, 5, 922404), 60, 'awaiting_deposit', 'single', None, None, 100.0, UUID('97576b68-ba8a-4aec-92f0-753a635d8857'))]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
[2m2026-02-05T14:49:06.205923Z[0m [[31m[1merror    [0m] [1mRequest completed             [0m [[0m[1m[34mapp.core.middleware[0m][0m [36mapp[0m=[35m'Navaro API'[0m [36mduration_ms[0m=[35m282.75[0m [36menvironment[0m=[35mdevelopment[0m [36mmethod[0m=[35mPOST[0m [36mmode[0m=[35mdebug[0m [36mpath[0m=[35m/api/v1/appointments[0m [36mrequest_id[0m=[35me7851f0d-289b-4324-b2ad-8ae9dcd948a0[0m [36mstatus_code[0m=[35m500[0m [36mversion[0m=[35m1.0.0[0m
F[2m2026-02-05T14:49:06.294050Z[0m [[32m[1minfo     [0m] [1mShutting down application     [0m [[0m[1m[34mapp.main[0m][0m [36mapp[0m=[35m'Navaro API'[0m [36menvironment[0m=[35mdevelopment[0m [36mmode[0m=[35mdebug[0m [36mversion[0m=[35m1.0.0[0m
[2m2026-02-05T14:49:06.302624Z[0m [[32m[1minfo     [0m] [1mDatabase connections closed   [0m [[0m[1m[34mapp.main[0m][0m [36mapp[0m=[35m'Navaro API'[0m [36menvironment[0m=[35mdevelopment[0m [36mmode[0m=[35mdebug[0m [36mversion[0m=[35m1.0.0[0m

=================================== FAILURES ===================================
_________________________ test_no_show_and_wallet_flow _________________________

client = <httpx.AsyncClient object at 0x7f66ac847e00>

    @pytest.mark.asyncio
    async def test_no_show_and_wallet_flow(client: AsyncClient):
        # ─── 1. Setup ────────────────────────────────────────────────────────────
        phone = "+5511988887777"
        resp = await client.post("/api/v1/auth/send-code", json={"phone": phone})
        code = resp.json()["message"].split(": ")[1].strip()
        resp = await client.post("/api/v1/auth/verify", json={"phone": phone, "code": code})
        token = resp.json()["tokens"]["access_token"]
        headers = {"Authorization": f"Bearer {token}"}
    
        # Create Establishment with 50% No-Show Fee
        est_resp = await client.post("/api/v1/establishments", json={
            "name": "Advanced Barbershop",
            "category": "barbershop",
            "address": "Feature St",
            "city": "São Paulo",
            "state": "SP",
            "phone": "+551177777777",
            "no_show_fee_percent": 50.0,
            "business_hours": {day: {"open": "00:00", "close": "23:59"} for day in ["mon", "tue", "wed", "thu", "fri", "sat", "sun"]}
        }, headers=headers)
        est_id = est_resp.json()["id"]
    
        # Create Staff
        staff_resp = await client.post(f"/api/v1/establishments/{est_id}/staff", json={
            "name": "Expert Barber",
            "role": "barber",
            "work_schedule": {day: {"open": "00:00", "close": "23:59"} for day in ["mon", "tue", "wed", "thu", "fri", "sat", "sun"]}
        }, headers=headers)
        staff_id = staff_resp.json()["id"]
    
        # Create Service (R$ 100,00)
        svc_resp = await client.post(f"/api/v1/establishments/{est_id}/services", json={
            "name": "Luxury Cut",
            "price": 100.0,
            "duration_minutes": 60,
            "deposit_required": True
        }, headers=headers)
        svc_id = svc_resp.json()["id"]
    
        # ─── 2. Test Deposit Requirement ─────────────────────────────────────────
        appt_resp = await client.post("/api/v1/appointments", json={
            "establishment_id": est_id,
            "service_id": svc_id,
            "staff_id": staff_id,
            "scheduled_at": (datetime.now() + timedelta(days=2)).isoformat(),
            "payment_type": "single"
        }, headers=headers)
>       assert appt_resp.status_code == 201
E       assert 500 == 201
E        +  where 500 = <Response [500 Internal Server Error]>.status_code

tests/api/v1/test_advanced_payments.py:54: AssertionError
------------------------------ Captured log setup ------------------------------
DEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector
DEBUG    asyncio:selector_events.py:64 Using selector: EpollSelector
INFO     app.main:main.py:28 [2m2026-02-05T14:49:05.147750Z[0m [[32m[1minfo     [0m] [1mStarting application          [0m [[0m[1m[34mapp.main[0m][0m [36mapp[0m=[35m'Navaro API'[0m [36menvironment[0m=[35mdevelopment[0m [36mmode[0m=[35mdebug[0m [36mname[0m=[35m'Navaro API'[0m [36mversion[0m=[35m1.0.0[0m
INFO     sqlalchemy.engine.Engine:base.py:1846 select pg_catalog.version()
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 select current_schema()
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 show standard_conforming_strings
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:2710 BEGIN (implicit)
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     sqlalchemy.engine.Engine:base.py:1846 [generated in 0.00057s] ('users', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     sqlalchemy.engine.Engine:base.py:1846 [cached since 0.01764s ago] ('establishments', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     sqlalchemy.engine.Engine:base.py:1846 [cached since 0.02005s ago] ('service_staff', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     sqlalchemy.engine.Engine:base.py:1846 [cached since 0.02284s ago] ('services', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     sqlalchemy.engine.Engine:base.py:1846 [cached since 0.02569s ago] ('service_bundles', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     sqlalchemy.engine.Engine:base.py:1846 [cached since 0.02762s ago] ('service_bundle_items', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     sqlalchemy.engine.Engine:base.py:1846 [cached since 0.03033s ago] ('staff_members', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     sqlalchemy.engine.Engine:base.py:1846 [cached since 0.03159s ago] ('staff_blocks', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     sqlalchemy.engine.Engine:base.py:1846 [cached since 0.03298s ago] ('subscription_plans', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     sqlalchemy.engine.Engine:base.py:1846 [cached since 0.03437s ago] ('subscription_plan_items', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     sqlalchemy.engine.Engine:base.py:1846 [cached since 0.03564s ago] ('subscriptions', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     sqlalchemy.engine.Engine:base.py:1846 [cached since 0.03669s ago] ('subscription_usage', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     sqlalchemy.engine.Engine:base.py:1846 [cached since 0.03931s ago] ('appointments', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     sqlalchemy.engine.Engine:base.py:1846 [cached since 0.04062s ago] ('appointment_products', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     sqlalchemy.engine.Engine:base.py:1846 [cached since 0.04298s ago] ('checkins', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     sqlalchemy.engine.Engine:base.py:1846 [cached since 0.04547s ago] ('queue_entries', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     sqlalchemy.engine.Engine:base.py:1846 [cached since 0.04945s ago] ('reviews', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     sqlalchemy.engine.Engine:base.py:1846 [cached since 0.05284s ago] ('favorites', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     sqlalchemy.engine.Engine:base.py:1846 [cached since 0.05469s ago] ('favorite_staff', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     sqlalchemy.engine.Engine:base.py:1846 [cached since 0.05781s ago] ('payments', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     sqlalchemy.engine.Engine:base.py:1846 [cached since 0.06078s ago] ('tips', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     sqlalchemy.engine.Engine:base.py:1846 [cached since 0.06411s ago] ('payouts', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     sqlalchemy.engine.Engine:base.py:1846 [cached since 0.06744s ago] ('portfolio_images', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     sqlalchemy.engine.Engine:base.py:1846 [cached since 0.06953s ago] ('search_history', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     sqlalchemy.engine.Engine:base.py:1846 [cached since 0.07177s ago] ('products', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     sqlalchemy.engine.Engine:base.py:1846 [cached since 0.07388s ago] ('establishment_plugins', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     sqlalchemy.engine.Engine:base.py:1846 [cached since 0.07553s ago] ('ad_campaigns', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     sqlalchemy.engine.Engine:base.py:1846 [cached since 0.07665s ago] ('notifications', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     sqlalchemy.engine.Engine:base.py:1846 [cached since 0.08116s ago] ('user_debts', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     sqlalchemy.engine.Engine:base.py:1846 [cached since 0.08353s ago] ('user_wallets', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     sqlalchemy.engine.Engine:base.py:1846 [cached since 0.08599s ago] ('wallet_transactions', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
INFO     sqlalchemy.engine.Engine:base.py:1846 [generated in 0.00096s] ('userrole', 'pg_catalog')
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
INFO     sqlalchemy.engine.Engine:base.py:1846 [cached since 0.008385s ago] ('establishmentcategory', 'pg_catalog')
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
INFO     sqlalchemy.engine.Engine:base.py:1846 [cached since 0.01218s ago] ('establishmentstatus', 'pg_catalog')
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
INFO     sqlalchemy.engine.Engine:base.py:1846 [cached since 0.01561s ago] ('subscriptiontier', 'pg_catalog')
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
INFO     sqlalchemy.engine.Engine:base.py:1846 [cached since 0.0193s ago] ('subscriptionstatus', 'pg_catalog')
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
INFO     sqlalchemy.engine.Engine:base.py:1846 [cached since 0.02344s ago] ('appointmentstatus', 'pg_catalog')
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
INFO     sqlalchemy.engine.Engine:base.py:1846 [cached since 0.02616s ago] ('paymenttype', 'pg_catalog')
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
INFO     sqlalchemy.engine.Engine:base.py:1846 [cached since 0.02794s ago] ('queuestatus', 'pg_catalog')
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
INFO     sqlalchemy.engine.Engine:base.py:1846 [cached since 0.02938s ago] ('paymentpurpose', 'pg_catalog')
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
INFO     sqlalchemy.engine.Engine:base.py:1846 [cached since 0.03131s ago] ('paymentstatus', 'pg_catalog')
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
INFO     sqlalchemy.engine.Engine:base.py:1846 [cached since 0.03307s ago] ('notificationtype', 'pg_catalog')
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
INFO     sqlalchemy.engine.Engine:base.py:1846 [cached since 0.0353s ago] ('debtstatus', 'pg_catalog')
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
INFO     sqlalchemy.engine.Engine:base.py:1846 [cached since 0.03675s ago] ('transactiontype', 'pg_catalog')
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT pg_catalog.pg_type.typname 
FROM pg_catalog.pg_type JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_type.typnamespace 
WHERE pg_catalog.pg_type.typname = $1::VARCHAR AND pg_catalog.pg_type_is_visible(pg_catalog.pg_type.oid) AND pg_catalog.pg_namespace.nspname != $2::VARCHAR
INFO     sqlalchemy.engine.Engine:base.py:1846 [cached since 0.03876s ago] ('transactionstatus', 'pg_catalog')
INFO     sqlalchemy.engine.Engine:base.py:2716 COMMIT
INFO     app.main:main.py:37 [2m2026-02-05T14:49:05.362090Z[0m [[32m[1minfo     [0m] [1mDatabase initialized          [0m [[0m[1m[34mapp.main[0m][0m [36mapp[0m=[35m'Navaro API'[0m [36menvironment[0m=[35mdevelopment[0m [36mmode[0m=[35mdebug[0m [36mversion[0m=[35m1.0.0[0m
------------------------------ Captured log call -------------------------------
INFO     app.api.v1.auth:auth.py:96 [2m2026-02-05T14:49:05.369337Z[0m [[32m[1minfo     [0m] [1mVerification code sent        [0m [[0m[1m[34mapp.api.v1.auth[0m][0m [36mapp[0m=[35m'Navaro API'[0m [36menvironment[0m=[35mdevelopment[0m [36mmethod[0m=[35mPOST[0m [36mmode[0m=[35mdebug[0m [36mpath[0m=[35m/api/v1/auth/send-code[0m [36mphone[0m=[35m+5511988887777[0m [36mrequest_id[0m=[35me5358a0f-b13a-4dac-acf9-93293613b92c[0m [36mversion[0m=[35m1.0.0[0m
INFO     app.core.middleware:middleware.py:56 [2m2026-02-05T14:49:05.370238Z[0m [[32m[1minfo     [0m] [1mRequest completed             [0m [[0m[1m[34mapp.core.middleware[0m][0m [36mapp[0m=[35m'Navaro API'[0m [36mduration_ms[0m=[35m5.01[0m [36menvironment[0m=[35mdevelopment[0m [36mmethod[0m=[35mPOST[0m [36mmode[0m=[35mdebug[0m [36mpath[0m=[35m/api/v1/auth/send-code[0m [36mrequest_id[0m=[35me5358a0f-b13a-4dac-acf9-93293613b92c[0m [36mstatus_code[0m=[35m200[0m [36mversion[0m=[35m1.0.0[0m
INFO     sqlalchemy.engine.Engine:base.py:2710 BEGIN (implicit)
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT users.phone, users.name, users.email, users.avatar_url, users.role, users.referral_code, users.referred_by_id, users.id, users.created_at, users.updated_at 
FROM users 
WHERE users.phone = $1::VARCHAR
INFO     sqlalchemy.engine.Engine:base.py:1846 [generated in 0.00049s] ('+5511988887777',)
INFO     app.api.v1.auth:auth.py:168 [2m2026-02-05T14:49:05.568355Z[0m [[32m[1minfo     [0m] [1mUser authenticated            [0m [[0m[1m[34mapp.api.v1.auth[0m][0m [36mapp[0m=[35m'Navaro API'[0m [36menvironment[0m=[35mdevelopment[0m [36mmethod[0m=[35mPOST[0m [36mmode[0m=[35mdebug[0m [36mpath[0m=[35m/api/v1/auth/verify[0m [36mrequest_id[0m=[35m8936ccb2-fe60-4cbf-aee7-fe7305ff4e6b[0m [36muser_id[0m=[35m1bec427c-d8f4-47f8-963a-f2dcba2a6133[0m [36mversion[0m=[35m1.0.0[0m
INFO     sqlalchemy.engine.Engine:base.py:2713 ROLLBACK
INFO     app.core.middleware:middleware.py:56 [2m2026-02-05T14:49:05.570379Z[0m [[32m[1minfo     [0m] [1mRequest completed             [0m [[0m[1m[34mapp.core.middleware[0m][0m [36mapp[0m=[35m'Navaro API'[0m [36mduration_ms[0m=[35m198.1[0m [36menvironment[0m=[35mdevelopment[0m [36mmethod[0m=[35mPOST[0m [36mmode[0m=[35mdebug[0m [36mpath[0m=[35m/api/v1/auth/verify[0m [36mrequest_id[0m=[35m8936ccb2-fe60-4cbf-aee7-fe7305ff4e6b[0m [36mstatus_code[0m=[35m200[0m [36mversion[0m=[35m1.0.0[0m
INFO     sqlalchemy.engine.Engine:base.py:2710 BEGIN (implicit)
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT users.phone, users.name, users.email, users.avatar_url, users.role, users.referral_code, users.referred_by_id, users.id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
INFO     sqlalchemy.engine.Engine:base.py:1846 [generated in 0.00034s] (UUID('1bec427c-d8f4-47f8-963a-f2dcba2a6133'),)
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT establishments.owner_id, establishments.name, establishments.slug, establishments.category, establishments.description, establishments.address, establishments.city, establishments.state, establishments.zip_code, establishments.latitude, establishments.longitude, establishments.phone, establishments.whatsapp, establishments.logo_url, establishments.cover_url, establishments.google_place_id, establishments.google_maps_url, establishments.business_hours, establishments.queue_mode_enabled, establishments.status, establishments.subscription_tier, establishments.stripe_account_id, establishments.cancellation_fee_fixed, establishments.no_show_fee_percent, establishments.deposit_percent, establishments.id, establishments.created_at, establishments.updated_at 
FROM establishments 
WHERE establishments.slug = $1::VARCHAR
INFO     sqlalchemy.engine.Engine:base.py:1846 [generated in 0.00048s] ('advanced-barbershop',)
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT establishments.owner_id, establishments.name, establishments.slug, establishments.category, establishments.description, establishments.address, establishments.city, establishments.state, establishments.zip_code, establishments.latitude, establishments.longitude, establishments.phone, establishments.whatsapp, establishments.logo_url, establishments.cover_url, establishments.google_place_id, establishments.google_maps_url, establishments.business_hours, establishments.queue_mode_enabled, establishments.status, establishments.subscription_tier, establishments.stripe_account_id, establishments.cancellation_fee_fixed, establishments.no_show_fee_percent, establishments.deposit_percent, establishments.id, establishments.created_at, establishments.updated_at 
FROM establishments 
WHERE establishments.slug = $1::VARCHAR
INFO     sqlalchemy.engine.Engine:base.py:1846 [cached since 0.02117s ago] ('advanced-barbershop-1',)
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT establishments.owner_id, establishments.name, establishments.slug, establishments.category, establishments.description, establishments.address, establishments.city, establishments.state, establishments.zip_code, establishments.latitude, establishments.longitude, establishments.phone, establishments.whatsapp, establishments.logo_url, establishments.cover_url, establishments.google_place_id, establishments.google_maps_url, establishments.business_hours, establishments.queue_mode_enabled, establishments.status, establishments.subscription_tier, establishments.stripe_account_id, establishments.cancellation_fee_fixed, establishments.no_show_fee_percent, establishments.deposit_percent, establishments.id, establishments.created_at, establishments.updated_at 
FROM establishments 
WHERE establishments.slug = $1::VARCHAR
INFO     sqlalchemy.engine.Engine:base.py:1846 [cached since 0.02426s ago] ('advanced-barbershop-2',)
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT establishments.owner_id, establishments.name, establishments.slug, establishments.category, establishments.description, establishments.address, establishments.city, establishments.state, establishments.zip_code, establishments.latitude, establishments.longitude, establishments.phone, establishments.whatsapp, establishments.logo_url, establishments.cover_url, establishments.google_place_id, establishments.google_maps_url, establishments.business_hours, establishments.queue_mode_enabled, establishments.status, establishments.subscription_tier, establishments.stripe_account_id, establishments.cancellation_fee_fixed, establishments.no_show_fee_percent, establishments.deposit_percent, establishments.id, establishments.created_at, establishments.updated_at 
FROM establishments 
WHERE establishments.slug = $1::VARCHAR
INFO     sqlalchemy.engine.Engine:base.py:1846 [cached since 0.02726s ago] ('advanced-barbershop-3',)
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT establishments.owner_id, establishments.name, establishments.slug, establishments.category, establishments.description, establishments.address, establishments.city, establishments.state, establishments.zip_code, establishments.latitude, establishments.longitude, establishments.phone, establishments.whatsapp, establishments.logo_url, establishments.cover_url, establishments.google_place_id, establishments.google_maps_url, establishments.business_hours, establishments.queue_mode_enabled, establishments.status, establishments.subscription_tier, establishments.stripe_account_id, establishments.cancellation_fee_fixed, establishments.no_show_fee_percent, establishments.deposit_percent, establishments.id, establishments.created_at, establishments.updated_at 
FROM establishments 
WHERE establishments.slug = $1::VARCHAR
INFO     sqlalchemy.engine.Engine:base.py:1846 [cached since 0.03122s ago] ('advanced-barbershop-4',)
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT establishments.owner_id, establishments.name, establishments.slug, establishments.category, establishments.description, establishments.address, establishments.city, establishments.state, establishments.zip_code, establishments.latitude, establishments.longitude, establishments.phone, establishments.whatsapp, establishments.logo_url, establishments.cover_url, establishments.google_place_id, establishments.google_maps_url, establishments.business_hours, establishments.queue_mode_enabled, establishments.status, establishments.subscription_tier, establishments.stripe_account_id, establishments.cancellation_fee_fixed, establishments.no_show_fee_percent, establishments.deposit_percent, establishments.id, establishments.created_at, establishments.updated_at 
FROM establishments 
WHERE establishments.slug = $1::VARCHAR
INFO     sqlalchemy.engine.Engine:base.py:1846 [cached since 0.03502s ago] ('advanced-barbershop-5',)
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT establishments.owner_id, establishments.name, establishments.slug, establishments.category, establishments.description, establishments.address, establishments.city, establishments.state, establishments.zip_code, establishments.latitude, establishments.longitude, establishments.phone, establishments.whatsapp, establishments.logo_url, establishments.cover_url, establishments.google_place_id, establishments.google_maps_url, establishments.business_hours, establishments.queue_mode_enabled, establishments.status, establishments.subscription_tier, establishments.stripe_account_id, establishments.cancellation_fee_fixed, establishments.no_show_fee_percent, establishments.deposit_percent, establishments.id, establishments.created_at, establishments.updated_at 
FROM establishments 
WHERE establishments.slug = $1::VARCHAR
INFO     sqlalchemy.engine.Engine:base.py:1846 [cached since 0.03911s ago] ('advanced-barbershop-6',)
INFO     sqlalchemy.engine.Engine:base.py:1846 INSERT INTO establishments (owner_id, name, slug, category, description, address, city, state, zip_code, latitude, longitude, phone, whatsapp, logo_url, cover_url, google_place_id, google_maps_url, business_hours, queue_mode_enabled, status, subscription_tier, stripe_account_id, cancellation_fee_fixed, no_show_fee_percent, deposit_percent, id) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::establishmentcategory, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::VARCHAR, $10::NUMERIC(10, 8), $11::NUMERIC(11, 8), $12::VARCHAR, $13::VARCHAR, $14::VARCHAR, $15::VARCHAR, $16::VARCHAR, $17::VARCHAR, $18::JSON, $19::BOOLEAN, $20::establishmentstatus, $21::subscriptiontier, $22::VARCHAR, $23::NUMERIC(10, 2), $24::NUMERIC(5, 2), $25::NUMERIC(5, 2), $26::UUID) RETURNING establishments.created_at, establishments.updated_at
INFO     sqlalchemy.engine.Engine:base.py:1846 [generated in 0.00069s] (UUID('1bec427c-d8f4-47f8-963a-f2dcba2a6133'), 'Advanced Barbershop', 'advanced-barbershop-6', 'barbershop', None, 'Feature St', 'São Paulo', 'SP', None, None, None, '+551177777777', None, None, None, None, None, '{"mon": {"open": "00:00", "close": "23:59"}, "tue": {"open": "00:00", "close": "23:59"}, "wed": {"open": "00:00", "close": "23:59"}, "thu": {"open":  ... (10 characters truncated) ... close": "23:59"}, "fri": {"open": "00:00", "close": "23:59"}, "sat": {"open": "00:00", "close": "23:59"}, "sun": {"open": "00:00", "close": "23:59"}}', False, 'pending', 'trial', None, 0.0, 50.0, 0.0, UUID('a2fae54f-0410-43de-8a97-37a9ec49af83'))
INFO     sqlalchemy.engine.Engine:base.py:2716 COMMIT
INFO     sqlalchemy.engine.Engine:base.py:2710 BEGIN (implicit)
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT establishments.owner_id, establishments.name, establishments.slug, establishments.category, establishments.description, establishments.address, establishments.city, establishments.state, establishments.zip_code, establishments.latitude, establishments.longitude, establishments.phone, establishments.whatsapp, establishments.logo_url, establishments.cover_url, establishments.google_place_id, establishments.google_maps_url, establishments.business_hours, establishments.queue_mode_enabled, establishments.status, establishments.subscription_tier, establishments.stripe_account_id, establishments.cancellation_fee_fixed, establishments.no_show_fee_percent, establishments.deposit_percent, establishments.id, establishments.created_at, establishments.updated_at 
FROM establishments 
WHERE establishments.id = $1::UUID
INFO     sqlalchemy.engine.Engine:base.py:1846 [generated in 0.00072s] (UUID('a2fae54f-0410-43de-8a97-37a9ec49af83'),)
INFO     sqlalchemy.engine.Engine:base.py:2713 ROLLBACK
INFO     app.core.middleware:middleware.py:56 [2m2026-02-05T14:49:05.666156Z[0m [[32m[1minfo     [0m] [1mRequest completed             [0m [[0m[1m[34mapp.core.middleware[0m][0m [36mapp[0m=[35m'Navaro API'[0m [36mduration_ms[0m=[35m93.27[0m [36menvironment[0m=[35mdevelopment[0m [36mmethod[0m=[35mPOST[0m [36mmode[0m=[35mdebug[0m [36mpath[0m=[35m/api/v1/establishments[0m [36mrequest_id[0m=[35m6201311b-7855-4d65-af91-fe6bbd8580b5[0m [36mstatus_code[0m=[35m201[0m [36mversion[0m=[35m1.0.0[0m
INFO     sqlalchemy.engine.Engine:base.py:2710 BEGIN (implicit)
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT users.phone, users.name, users.email, users.avatar_url, users.role, users.referral_code, users.referred_by_id, users.id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
INFO     sqlalchemy.engine.Engine:base.py:1846 [cached since 0.09835s ago] (UUID('1bec427c-d8f4-47f8-963a-f2dcba2a6133'),)
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT establishments.owner_id, establishments.name, establishments.slug, establishments.category, establishments.description, establishments.address, establishments.city, establishments.state, establishments.zip_code, establishments.latitude, establishments.longitude, establishments.phone, establishments.whatsapp, establishments.logo_url, establishments.cover_url, establishments.google_place_id, establishments.google_maps_url, establishments.business_hours, establishments.queue_mode_enabled, establishments.status, establishments.subscription_tier, establishments.stripe_account_id, establishments.cancellation_fee_fixed, establishments.no_show_fee_percent, establishments.deposit_percent, establishments.id, establishments.created_at, establishments.updated_at 
FROM establishments 
WHERE establishments.id = $1::UUID
INFO     sqlalchemy.engine.Engine:base.py:1846 [generated in 0.00050s] (UUID('a2fae54f-0410-43de-8a97-37a9ec49af83'),)
INFO     sqlalchemy.engine.Engine:base.py:1846 INSERT INTO staff_members (establishment_id, user_id, name, phone, role, avatar_url, work_schedule, commission_rate, active, id) VALUES ($1::UUID, $2::UUID, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::JSON, $8::NUMERIC(5, 2), $9::BOOLEAN, $10::UUID) RETURNING staff_members.created_at, staff_members.updated_at
INFO     sqlalchemy.engine.Engine:base.py:1846 [generated in 0.00062s] (UUID('a2fae54f-0410-43de-8a97-37a9ec49af83'), None, 'Expert Barber', None, 'barber', None, '{"mon": {"open": "00:00", "close": "23:59"}, "tue": {"open": "00:00", "close": "23:59"}, "wed": {"open": "00:00", "close": "23:59"}, "thu": {"open":  ... (10 characters truncated) ... close": "23:59"}, "fri": {"open": "00:00", "close": "23:59"}, "sat": {"open": "00:00", "close": "23:59"}, "sun": {"open": "00:00", "close": "23:59"}}', None, True, UUID('b83ea175-3b70-4ee5-8fb6-dacf01df9fe1'))
INFO     sqlalchemy.engine.Engine:base.py:2716 COMMIT
INFO     sqlalchemy.engine.Engine:base.py:2710 BEGIN (implicit)
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT staff_members.establishment_id, staff_members.user_id, staff_members.name, staff_members.phone, staff_members.role, staff_members.avatar_url, staff_members.work_schedule, staff_members.commission_rate, staff_members.active, staff_members.id, staff_members.created_at, staff_members.updated_at 
FROM staff_members 
WHERE staff_members.id = $1::UUID
INFO     sqlalchemy.engine.Engine:base.py:1846 [generated in 0.00050s] (UUID('b83ea175-3b70-4ee5-8fb6-dacf01df9fe1'),)
INFO     sqlalchemy.engine.Engine:base.py:2713 ROLLBACK
INFO     app.core.middleware:middleware.py:56 [2m2026-02-05T14:49:05.875716Z[0m [[32m[1minfo     [0m] [1mRequest completed             [0m [[0m[1m[34mapp.core.middleware[0m][0m [36mapp[0m=[35m'Navaro API'[0m [36mduration_ms[0m=[35m205.91[0m [36menvironment[0m=[35mdevelopment[0m [36mmethod[0m=[35mPOST[0m [36mmode[0m=[35mdebug[0m [36mpath[0m=[35m/api/v1/establishments/a2fae54f-0410-43de-8a97-37a9ec49af83/staff[0m [36mrequest_id[0m=[35mf658e9f2-4f97-4060-b4c1-2cfbb579db4c[0m [36mstatus_code[0m=[35m201[0m [36mversion[0m=[35m1.0.0[0m
INFO     sqlalchemy.engine.Engine:base.py:2710 BEGIN (implicit)
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT users.phone, users.name, users.email, users.avatar_url, users.role, users.referral_code, users.referred_by_id, users.id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
INFO     sqlalchemy.engine.Engine:base.py:1846 [cached since 0.3048s ago] (UUID('1bec427c-d8f4-47f8-963a-f2dcba2a6133'),)
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT establishments.owner_id, establishments.name, establishments.slug, establishments.category, establishments.description, establishments.address, establishments.city, establishments.state, establishments.zip_code, establishments.latitude, establishments.longitude, establishments.phone, establishments.whatsapp, establishments.logo_url, establishments.cover_url, establishments.google_place_id, establishments.google_maps_url, establishments.business_hours, establishments.queue_mode_enabled, establishments.status, establishments.subscription_tier, establishments.stripe_account_id, establishments.cancellation_fee_fixed, establishments.no_show_fee_percent, establishments.deposit_percent, establishments.id, establishments.created_at, establishments.updated_at 
FROM establishments 
WHERE establishments.id = $1::UUID
INFO     sqlalchemy.engine.Engine:base.py:1846 [cached since 0.2022s ago] (UUID('a2fae54f-0410-43de-8a97-37a9ec49af83'),)
INFO     sqlalchemy.engine.Engine:base.py:1846 INSERT INTO services (establishment_id, name, description, price, duration_minutes, active, sort_order, deposit_required, id) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::NUMERIC(10, 2), $5::INTEGER, $6::BOOLEAN, $7::INTEGER, $8::BOOLEAN, $9::UUID) RETURNING services.created_at, services.updated_at
INFO     sqlalchemy.engine.Engine:base.py:1846 [generated in 0.00065s] (UUID('a2fae54f-0410-43de-8a97-37a9ec49af83'), 'Luxury Cut', None, 100.0, 60, True, 0, True, UUID('7f44df62-050d-4e33-b4bb-5648225e4209'))
INFO     sqlalchemy.engine.Engine:base.py:2716 COMMIT
INFO     sqlalchemy.engine.Engine:base.py:2710 BEGIN (implicit)
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT services.establishment_id, services.name, services.description, services.price, services.duration_minutes, services.active, services.sort_order, services.deposit_required, services.id, services.created_at, services.updated_at 
FROM services 
WHERE services.id = $1::UUID
INFO     sqlalchemy.engine.Engine:base.py:1846 [generated in 0.00038s] (UUID('7f44df62-050d-4e33-b4bb-5648225e4209'),)
INFO     sqlalchemy.engine.Engine:base.py:2713 ROLLBACK
INFO     app.core.middleware:middleware.py:56 [2m2026-02-05T14:49:05.919192Z[0m [[32m[1minfo     [0m] [1mRequest completed             [0m [[0m[1m[34mapp.core.middleware[0m][0m [36mapp[0m=[35m'Navaro API'[0m [36mduration_ms[0m=[35m40.96[0m [36menvironment[0m=[35mdevelopment[0m [36mmethod[0m=[35mPOST[0m [36mmode[0m=[35mdebug[0m [36mpath[0m=[35m/api/v1/establishments/a2fae54f-0410-43de-8a97-37a9ec49af83/services[0m [36mrequest_id[0m=[35m3a502bc2-74cc-44dc-8e6f-d432ca6d7626[0m [36mstatus_code[0m=[35m201[0m [36mversion[0m=[35m1.0.0[0m
INFO     sqlalchemy.engine.Engine:base.py:1846 select pg_catalog.version()
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 select current_schema()
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:1846 show standard_conforming_strings
INFO     sqlalchemy.engine.Engine:base.py:1846 [raw sql] ()
INFO     sqlalchemy.engine.Engine:base.py:2710 BEGIN (implicit)
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT users.phone, users.name, users.email, users.avatar_url, users.role, users.referral_code, users.referred_by_id, users.id, users.created_at, users.updated_at 
FROM users 
WHERE users.id = $1::UUID
INFO     sqlalchemy.engine.Engine:base.py:1846 [generated in 0.00050s] (UUID('1bec427c-d8f4-47f8-963a-f2dcba2a6133'),)
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT services.establishment_id, services.name, services.description, services.price, services.duration_minutes, services.active, services.sort_order, services.deposit_required, services.id, services.created_at, services.updated_at 
FROM services 
WHERE services.id = $1::UUID
INFO     sqlalchemy.engine.Engine:base.py:1846 [generated in 0.00059s] (UUID('7f44df62-050d-4e33-b4bb-5648225e4209'),)
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT staff_members.establishment_id, staff_members.user_id, staff_members.name, staff_members.phone, staff_members.role, staff_members.avatar_url, staff_members.work_schedule, staff_members.commission_rate, staff_members.active, staff_members.id, staff_members.created_at, staff_members.updated_at 
FROM staff_members 
WHERE staff_members.id = $1::UUID
INFO     sqlalchemy.engine.Engine:base.py:1846 [generated in 0.00052s] (UUID('b83ea175-3b70-4ee5-8fb6-dacf01df9fe1'),)
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT establishments.owner_id, establishments.name, establishments.slug, establishments.category, establishments.description, establishments.address, establishments.city, establishments.state, establishments.zip_code, establishments.latitude, establishments.longitude, establishments.phone, establishments.whatsapp, establishments.logo_url, establishments.cover_url, establishments.google_place_id, establishments.google_maps_url, establishments.business_hours, establishments.queue_mode_enabled, establishments.status, establishments.subscription_tier, establishments.stripe_account_id, establishments.cancellation_fee_fixed, establishments.no_show_fee_percent, establishments.deposit_percent, establishments.id, establishments.created_at, establishments.updated_at 
FROM establishments 
WHERE establishments.id = $1::UUID
INFO     sqlalchemy.engine.Engine:base.py:1846 [generated in 0.00062s] (UUID('a2fae54f-0410-43de-8a97-37a9ec49af83'),)
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT staff_blocks.staff_id, staff_blocks.start_at, staff_blocks.end_at, staff_blocks.reason, staff_blocks.id, staff_blocks.created_at, staff_blocks.updated_at 
FROM staff_blocks 
WHERE staff_blocks.staff_id = $1::UUID AND staff_blocks.start_at < $2::TIMESTAMP WITH TIME ZONE AND staff_blocks.end_at > $3::TIMESTAMP WITH TIME ZONE
INFO     sqlalchemy.engine.Engine:base.py:1846 [generated in 0.00059s] (UUID('b83ea175-3b70-4ee5-8fb6-dacf01df9fe1'), datetime.datetime(2026, 2, 7, 16, 49, 5, 922404), datetime.datetime(2026, 2, 7, 15, 49, 5, 922404))
INFO     sqlalchemy.engine.Engine:base.py:1846 SELECT appointments.user_id, appointments.establishment_id, appointments.staff_id, appointments.service_id, appointments.bundle_id, appointments.subscription_id, appointments.scheduled_at, appointments.duration_minutes, appointments.status, appointments.payment_type, appointments.notes, appointments.cancel_reason, appointments.total_price, appointments.id, appointments.created_at, appointments.updated_at 
FROM appointments 
WHERE appointments.staff_id = $1::UUID AND appointments.status != $2::appointmentstatus AND appointments.scheduled_at < $3::TIMESTAMP WITH TIME ZONE
INFO     sqlalchemy.engine.Engine:base.py:1846 [generated in 0.00052s] (UUID('b83ea175-3b70-4ee5-8fb6-dacf01df9fe1'), 'cancelled', datetime.datetime(2026, 2, 7, 16, 49, 5, 922404))
INFO     sqlalchemy.engine.Engine:base.py:1846 INSERT INTO appointments (user_id, establishment_id, staff_id, service_id, bundle_id, subscription_id, scheduled_at, duration_minutes, status, payment_type, notes, cancel_reason, total_price, id) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::TIMESTAMP WITH TIME ZONE, $8::INTEGER, $9::appointmentstatus, $10::paymenttype, $11::VARCHAR, $12::VARCHAR, $13::NUMERIC(10, 2), $14::UUID) RETURNING appointments.created_at, appointments.updated_at
INFO     sqlalchemy.engine.Engine:base.py:1846 [generated in 0.00100s] (UUID('1bec427c-d8f4-47f8-963a-f2dcba2a6133'), UUID('a2fae54f-0410-43de-8a97-37a9ec49af83'), UUID('b83ea175-3b70-4ee5-8fb6-dacf01df9fe1'), UUID('7f44df62-050d-4e33-b4bb-5648225e4209'), None, None, datetime.datetime(2026, 2, 7, 15, 49, 5, 922404), 60, 'awaiting_deposit', 'single', None, None, 100.0, UUID('97576b68-ba8a-4aec-92f0-753a635d8857'))
INFO     sqlalchemy.engine.Engine:base.py:2713 ROLLBACK
ERROR    app.core.middleware:middleware.py:104 [2m2026-02-05T14:49:06.183210Z[0m [[31m[1merror    [0m] [1mUnhandled exception           [0m [[0m[1m[34mapp.core.middleware[0m][0m [36mapp[0m=[35m'Navaro API'[0m [36menvironment[0m=[35mdevelopment[0m [36merror[0m=[35m'(sqlalchemy.dialects.postgresql.asyncpg.Error) <class \'asyncpg.exceptions.InvalidTextRepresentationError\'>: invalid input value for enum appointmentstatus: "awaiting_deposit"\n[SQL: INSERT INTO appointments (user_id, establishment_id, staff_id, service_id, bundle_id, subscription_id, scheduled_at, duration_minutes, status, payment_type, notes, cancel_reason, total_price, id) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::TIMESTAMP WITH TIME ZONE, $8::INTEGER, $9::appointmentstatus, $10::paymenttype, $11::VARCHAR, $12::VARCHAR, $13::NUMERIC(10, 2), $14::UUID) RETURNING appointments.created_at, appointments.updated_at]\n[parameters: (UUID(\'1bec427c-d8f4-47f8-963a-f2dcba2a6133\'), UUID(\'a2fae54f-0410-43de-8a97-37a9ec49af83\'), UUID(\'b83ea175-3b70-4ee5-8fb6-dacf01df9fe1\'), UUID(\'7f44df62-050d-4e33-b4bb-5648225e4209\'), None, None, datetime.datetime(2026, 2, 7, 15, 49, 5, 922404), 60, \'awaiting_deposit\', \'single\', None, None, 100.0, UUID(\'97576b68-ba8a-4aec-92f0-753a635d8857\'))]\n(Background on this error at: https://sqlalche.me/e/20/dbapi)'[0m [36mmethod[0m=[35mPOST[0m [36mmode[0m=[35mdebug[0m [36mpath[0m=[35m/api/v1/appointments[0m [36mrequest_id[0m=[35me7851f0d-289b-4324-b2ad-8ae9dcd948a0[0m [36mversion[0m=[35m1.0.0[0m
Traceback (most recent call last):
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 550, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/asyncpg/prepared_stmt.py", line 177, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/asyncpg/prepared_stmt.py", line 268, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/asyncpg/prepared_stmt.py", line 257, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 205, in bind_execute
asyncpg.exceptions.InvalidTextRepresentationError: invalid input value for enum appointmentstatus: "awaiting_deposit"

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 952, in do_execute
    cursor.execute(statement, parameters)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 585, in execute
    self._adapt_connection.await_(
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 563, in _prepare_and_execute
    self._handle_exception(error)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 513, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 797, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.InvalidTextRepresentationError'>: invalid input value for enum appointmentstatus: "awaiting_deposit"

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/projetos/navaro/packages/api/app/core/middleware.py", line 78, in dispatch
    return await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/usr/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/app/core/middleware.py", line 175, in dispatch
    return await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/fastapi/routing.py", line 115, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/fastapi/routing.py", line 101, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/fastapi/routing.py", line 355, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/fastapi/routing.py", line 243, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/app/api/v1/appointments.py", line 68, in create_appointment
    appointment = await service.create(current_user.id, data)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/app/services/appointment_service.py", line 166, in create
    await self.db.flush()
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 787, in flush
    await greenlet_spawn(self.sync_session.flush, objects=objects)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4331, in flush
    self._flush(objects)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4466, in _flush
    with util.safe_reraise():
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4427, in _flush
    flush_context.execute()
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 527, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2363, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 952, in do_execute
    cursor.execute(statement, parameters)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 585, in execute
    self._adapt_connection.await_(
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 563, in _prepare_and_execute
    self._handle_exception(error)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 513, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 797, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.InvalidTextRepresentationError'>: invalid input value for enum appointmentstatus: "awaiting_deposit"
[SQL: INSERT INTO appointments (user_id, establishment_id, staff_id, service_id, bundle_id, subscription_id, scheduled_at, duration_minutes, status, payment_type, notes, cancel_reason, total_price, id) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::TIMESTAMP WITH TIME ZONE, $8::INTEGER, $9::appointmentstatus, $10::paymenttype, $11::VARCHAR, $12::VARCHAR, $13::NUMERIC(10, 2), $14::UUID) RETURNING appointments.created_at, appointments.updated_at]
[parameters: (UUID('1bec427c-d8f4-47f8-963a-f2dcba2a6133'), UUID('a2fae54f-0410-43de-8a97-37a9ec49af83'), UUID('b83ea175-3b70-4ee5-8fb6-dacf01df9fe1'), UUID('7f44df62-050d-4e33-b4bb-5648225e4209'), None, None, datetime.datetime(2026, 2, 7, 15, 49, 5, 922404), 60, 'awaiting_deposit', 'single', None, None, 100.0, UUID('97576b68-ba8a-4aec-92f0-753a635d8857'))]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
Traceback (most recent call last):
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 550, in _prepare_and_execute
    self._rows = deque(await prepared_stmt.fetch(*parameters))
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/asyncpg/prepared_stmt.py", line 177, in fetch
    data = await self.__bind_execute(args, 0, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/asyncpg/prepared_stmt.py", line 268, in __bind_execute
    data, status, _ = await self.__do_execute(
                      ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/asyncpg/prepared_stmt.py", line 257, in __do_execute
    return await executor(protocol)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg/protocol/protocol.pyx", line 205, in bind_execute
asyncpg.exceptions.InvalidTextRepresentationError: invalid input value for enum appointmentstatus: "awaiting_deposit"

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 952, in do_execute
    cursor.execute(statement, parameters)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 585, in execute
    self._adapt_connection.await_(
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 563, in _prepare_and_execute
    self._handle_exception(error)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 513, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 797, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.InvalidTextRepresentationError'>: invalid input value for enum appointmentstatus: "awaiting_deposit"

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/projetos/navaro/packages/api/app/core/middleware.py", line 78, in dispatch
    return await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 191, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/usr/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 193, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/app/core/middleware.py", line 175, in dispatch
    return await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 168, in call_next
    raise app_exc from app_exc.__cause__ or app_exc.__context__
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/fastapi/routing.py", line 115, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/fastapi/routing.py", line 101, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/fastapi/routing.py", line 355, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/fastapi/routing.py", line 243, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/app/api/v1/appointments.py", line 68, in create_appointment
    appointment = await service.create(current_user.id, data)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/app/services/appointment_service.py", line 166, in create
    await self.db.flush()
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 787, in flush
    await greenlet_spawn(self.sync_session.flush, objects=objects)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4331, in flush
    self._flush(objects)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4466, in _flush
    with util.safe_reraise():
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4427, in _flush
    flush_context.execute()
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 527, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2363, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 952, in do_execute
    cursor.execute(statement, parameters)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 585, in execute
    self._adapt_connection.await_(
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 563, in _prepare_and_execute
    self._handle_exception(error)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 513, in _handle_exception
    self._adapt_connection._handle_exception(error)
  File "/root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 797, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.InvalidTextRepresentationError'>: invalid input value for enum appointmentstatus: "awaiting_deposit"
[SQL: INSERT INTO appointments (user_id, establishment_id, staff_id, service_id, bundle_id, subscription_id, scheduled_at, duration_minutes, status, payment_type, notes, cancel_reason, total_price, id) VALUES ($1::UUID, $2::UUID, $3::UUID, $4::UUID, $5::UUID, $6::UUID, $7::TIMESTAMP WITH TIME ZONE, $8::INTEGER, $9::appointmentstatus, $10::paymenttype, $11::VARCHAR, $12::VARCHAR, $13::NUMERIC(10, 2), $14::UUID) RETURNING appointments.created_at, appointments.updated_at]
[parameters: (UUID('1bec427c-d8f4-47f8-963a-f2dcba2a6133'), UUID('a2fae54f-0410-43de-8a97-37a9ec49af83'), UUID('b83ea175-3b70-4ee5-8fb6-dacf01df9fe1'), UUID('7f44df62-050d-4e33-b4bb-5648225e4209'), None, None, datetime.datetime(2026, 2, 7, 15, 49, 5, 922404), 60, 'awaiting_deposit', 'single', None, None, 100.0, UUID('97576b68-ba8a-4aec-92f0-753a635d8857'))]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
ERROR    app.core.middleware:middleware.py:56 [2m2026-02-05T14:49:06.205923Z[0m [[31m[1merror    [0m] [1mRequest completed             [0m [[0m[1m[34mapp.core.middleware[0m][0m [36mapp[0m=[35m'Navaro API'[0m [36mduration_ms[0m=[35m282.75[0m [36menvironment[0m=[35mdevelopment[0m [36mmethod[0m=[35mPOST[0m [36mmode[0m=[35mdebug[0m [36mpath[0m=[35m/api/v1/appointments[0m [36mrequest_id[0m=[35me7851f0d-289b-4324-b2ad-8ae9dcd948a0[0m [36mstatus_code[0m=[35m500[0m [36mversion[0m=[35m1.0.0[0m
---------------------------- Captured log teardown -----------------------------
INFO     app.main:main.py:42 [2m2026-02-05T14:49:06.294050Z[0m [[32m[1minfo     [0m] [1mShutting down application     [0m [[0m[1m[34mapp.main[0m][0m [36mapp[0m=[35m'Navaro API'[0m [36menvironment[0m=[35mdevelopment[0m [36mmode[0m=[35mdebug[0m [36mversion[0m=[35m1.0.0[0m
INFO     app.main:main.py:44 [2m2026-02-05T14:49:06.302624Z[0m [[32m[1minfo     [0m] [1mDatabase connections closed   [0m [[0m[1m[34mapp.main[0m][0m [36mapp[0m=[35m'Navaro API'[0m [36menvironment[0m=[35mdevelopment[0m [36mmode[0m=[35mdebug[0m [36mversion[0m=[35m1.0.0[0m
=============================== warnings summary ===============================
venv/lib/python3.12/site-packages/passlib/utils/__init__.py:854
  /root/projetos/navaro/packages/api/venv/lib/python3.12/site-packages/passlib/utils/__init__.py:854: DeprecationWarning: 'crypt' is deprecated and slated for removal in Python 3.13
    from crypt import crypt as _crypt

app/api/v1/users.py:16
  /root/projetos/navaro/packages/api/app/api/v1/users.py:16: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class UserResponse(BaseModel):

app/api/v1/establishments.py:65
  /root/projetos/navaro/packages/api/app/api/v1/establishments.py:65: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class EstablishmentResponse(BaseModel):

app/api/v1/services.py:40
  /root/projetos/navaro/packages/api/app/api/v1/services.py:40: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class ServiceResponse(BaseModel):

app/api/v1/staff.py:41
  /root/projetos/navaro/packages/api/app/api/v1/staff.py:41: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class StaffResponse(BaseModel):

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
FAILED tests/api/v1/test_advanced_payments.py::test_no_show_and_wallet_flow
1 failed, 5 warnings in 1.18s
